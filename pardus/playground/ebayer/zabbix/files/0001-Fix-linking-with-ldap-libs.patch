From 90b086b4daebf61756e3d6f8926cf8951a2fc96a Mon Sep 17 00:00:00 2001
From: Vladimir V. Kamarzin <vvk@altlinux.org>
Date: Fri, 22 Oct 2010 17:47:01 +0600
Subject: [PATCH 1/2] Fix linking with ldap libs

Move "-lldap -llber" from LDAP_LDFLAGS to LDAP_LIBS and include them to
LIBS
---
 configure.in |    1 +
 m4/ldap.m4   |    4 +++-
 2 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/configure.in b/configure.in
index d3d981b..b11b2ee 100644
--- a/configure.in
+++ b/configure.in
@@ -1221,6 +1221,7 @@ if test "x$want_ldap" = "xyes"; then
 fi
 CFLAGS="${CFLAGS} ${LDAP_CPPFLAGS}"
 LDFLAGS="${LDFLAGS} ${LDAP_LDFLAGS}"
+LIBS="${LIBS} ${LDAP_LIBS}"
 
 found_iconv="no"
 dnl Check for libiconv [by default - skip]
diff --git a/m4/ldap.m4 b/m4/ldap.m4
index 29e97cd..885b3e0 100644
--- a/m4/ldap.m4
+++ b/m4/ldap.m4
@@ -72,7 +72,8 @@ AC_HELP_STRING([--with-ldap@<:@=DIR@:>@],[Include LDAP support @<:@default=no@:>
                fi
 
                LDAP_CPPFLAGS=-I$LDAP_INCDIR
-               LDAP_LDFLAGS="-L$LDAP_LIBDIR -lldap -llber $LDAP_LIBS"
+               LDAP_LDFLAGS="-L$LDAP_LIBDIR $LDAP_LIBS"
+               LDAP_LIBS="-lldap -llber $LDAP_LIBS"
 
                found_ldap="yes"
                AC_DEFINE(HAVE_LDAP,1,[Define to 1 if LDAP should be enabled.])
@@ -92,6 +93,7 @@ AC_HELP_STRING([--with-ldap@<:@=DIR@:>@],[Include LDAP support @<:@default=no@:>
 
   AC_SUBST(LDAP_CPPFLAGS)
   AC_SUBST(LDAP_LDFLAGS)
+  AC_SUBST(LDAP_LIBS)
 
   unset _libldap_with
 ])dnl
-- 
1.7.3.1

