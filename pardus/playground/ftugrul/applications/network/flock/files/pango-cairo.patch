Index: gfx/src/gtk/mozilla-decoder.cpp
===================================================================
RCS file: /cvsroot/mozilla/gfx/src/gtk/mozilla-decoder.cpp,v
retrieving revision 1.3
diff -u -p -6 -r1.3 mozilla-decoder.cpp
--- gfx/src/gtk/mozilla-decoder.cpp	7 Nov 2004 23:59:23 -0000	1.3
+++ gfx/src/gtk/mozilla-decoder.cpp	27 Aug 2005 19:57:49 -0000
@@ -40,7 +40,8 @@
 #define PANGO_ENABLE_ENGINE
 
 #include "mozilla-decoder.h"
+#include <pango/pangocairo.h>
 #include <pango/pangofc-fontmap.h>
 #include <pango/pangofc-font.h>
 #include <gdk/gdkpango.h>
 
@@ -214,7 +215,7 @@
         }
     }
 
-    pango_fc_font_map_add_decoder_find_func(PANGO_FC_FONT_MAP(fontmap),
+    pango_fc_font_map_add_decoder_find_func(PANGO_FC_FONT_MAP(pango_cairo_font_map_get_default()),
                                             mozilla_find_decoder,
                                             NULL,
                                             NULL);
Index: configure.in
===================================================================
RCS file: /cvsroot/mozilla/configure.in,v
retrieving revision 1.1503.2.6
diff -u -p -6 -r1.1503.2.6 configure.in
--- configure.in	25 Aug 2005 19:05:34 -0000	1.1503.2.6
+++ configure.in	29 Aug 2005 08:03:32 -0000
@@ -4036,8 +4036,8 @@
     MOZ_ENABLE_GTK2=1
     MOZ_ENABLE_XREMOTE=1
     MOZ_ENABLE_COREXFONTS=${MOZ_ENABLE_COREXFONTS-}
-    TK_CFLAGS='$(MOZ_GTK2_CFLAGS)'
-    TK_LIBS='$(MOZ_GTK2_LIBS)'
+    TK_CFLAGS='$(MOZ_GTK2_CFLAGS) $(MOZ_PANGO_CFLAGS)'
+    TK_LIBS='$(MOZ_GTK2_LIBS) $(MOZ_PANGO_LIBS)'
     AC_DEFINE(MOZ_WIDGET_GTK2)
     ;;
 
@@ -4695,27 +4695,38 @@
 then
     AC_DEFINE(MOZ_ENABLE_XFT)
     PKG_CHECK_MODULES(MOZ_XFT, xft)
-    PKG_CHECK_MODULES(_PANGOCHK, pango >= 1.1.0)
+    PKG_CHECK_MODULES(MOZ_PANGO, pangoxft >= 1.1.0 pangox)
 fi
 
 AC_SUBST(MOZ_ENABLE_XFT)
 AC_SUBST(MOZ_XFT_CFLAGS)
 AC_SUBST(MOZ_XFT_LIBS)
+AC_SUBST(MOZ_PANGO_CFLAGS)
+AC_SUBST(MOZ_PANGO_LIBS)
 
 dnl ========================================================
 dnl = pango font rendering
 dnl ========================================================
 MOZ_ARG_ENABLE_BOOL(pango,
 [  --enable-pango          Enable Pango font rendering support],
     MOZ_ENABLE_PANGO=1,
     MOZ_ENABLE_PANGO=)
 
 if test "$MOZ_ENABLE_PANGO"
 then
     AC_DEFINE(MOZ_ENABLE_PANGO)
     PKG_CHECK_MODULES(MOZ_PANGO, pango >= 1.6.0 pangoft2 >= 1.6.0)
+    PKG_CHECK_MODULES(PANGOCAIRO_CHK, pangocairo >= 1.10.0,
+    [ 
+      MOZ_PANGOCAIRO=1
+      AC_DEFINE(MOZ_PANGOCAIRO)
+      MOZ_PANGO_CFLAGS="$PANGOCAIRO_CHK_CFLAGS $MOZ_PANGO_CFLAGS"
+      MOZ_PANGO_LIBS="$PANGOCAIRO_CHK_LIBS $MOZ_PANGO_LIBS"
+    ],
+    [:])
 
     AC_SUBST(MOZ_ENABLE_PANGO)
+    AC_SUBST(MOZ_PANGOCAIRO)
     AC_SUBST(MOZ_PANGO_CFLAGS)
     AC_SUBST(MOZ_PANGO_LIBS)
 fi
