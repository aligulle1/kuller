Index: LVM2.2.02.47/lib/commands/toolcontext.c
===================================================================
--- LVM2.2.02.47.orig/lib/commands/toolcontext.c
+++ LVM2.2.02.47/lib/commands/toolcontext.c
@@ -1006,10 +1006,10 @@ struct cmd_context *create_toolcontext(u
 #ifdef M_MMAP_MAX
 	mallopt(M_MMAP_MAX, 0);
 #endif
-
+#ifdef __dietlibc__
 	if (!setlocale(LC_ALL, ""))
 		log_very_verbose("setlocale failed");
-
+#endif
 #ifdef INTL_PACKAGE
 	bindtextdomain(INTL_PACKAGE, LOCALEDIR);
 #endif
Index: LVM2.2.02.47/lib/locking/file_locking.c
===================================================================
--- LVM2.2.02.47.orig/lib/locking/file_locking.c
+++ LVM2.2.02.47/lib/locking/file_locking.c
@@ -30,6 +30,10 @@
 #include <fcntl.h>
 #include <signal.h>
 
+#ifdef __dietlibc__
+typedef void (*sig_t) (int);
+#endif
+
 struct lock_list {
 	struct dm_list list;
 	int lf;
Index: LVM2.2.02.47/libdm/libdevmapper.h
===================================================================
--- LVM2.2.02.47.orig/libdm/libdevmapper.h
+++ LVM2.2.02.47/libdm/libdevmapper.h
@@ -160,6 +160,10 @@ int dm_task_suppress_identical_reload(st
 /*
  * Control read_ahead.
  */
+#ifdef __dietlibc__
+# define UINT32_MAX             (4294967295U)
+#endif
+
 #define DM_READ_AHEAD_AUTO UINT32_MAX	/* Use kernel default readahead */
 #define DM_READ_AHEAD_NONE 0		/* Disable readahead */
 
Index: LVM2.2.02.47/lib/config/config.c
===================================================================
--- LVM2.2.02.47.orig/lib/config/config.c
+++ LVM2.2.02.47/lib/config/config.c
@@ -28,6 +28,10 @@
 #include <fcntl.h>
 #include <ctype.h>
 
+#ifdef __dietlibc__
+typedef char* caddr_t __attribute_dontuse__;
+#endif
+
 #define SECTION_B_CHAR '{'
 #define SECTION_E_CHAR '}'
 
Index: LVM2.2.02.47/lib/misc/lib.h
===================================================================
--- LVM2.2.02.47.orig/lib/misc/lib.h
+++ LVM2.2.02.47/lib/misc/lib.h
@@ -45,4 +45,20 @@
 #include <unistd.h>
 #include <sys/stat.h>
 
+#ifdef __dietlibc__
+# include <strings.h>
+# include <limits.h>
+# if __WORDSIZE == 64
+#  define INT64_C(c)    c ## L
+# else
+#  define INT64_C(c)    c ## LL
+# endif
+# define UINT32_C(c)    c ## U
+# if __WORDSIZE == 64
+#  define UINT64_C(c)   c ## UL
+# else
+#  define UINT64_C(c)   c ## ULL
+# endif
+#endif
+
 #endif
Index: LVM2.2.02.47/tools/tools.h
===================================================================
--- LVM2.2.02.47.orig/tools/tools.h
+++ LVM2.2.02.47/tools/tools.h
@@ -55,6 +55,21 @@
 #include <stdarg.h>
 #include <sys/types.h>
 
+#ifdef __dietlibc__
+# include <limits.h>
+# if __WORDSIZE == 64
+#  define INT64_C(c)    c ## L
+# else
+#  define INT64_C(c)    c ## LL
+# endif
+# define UINT32_C(c)    c ## U
+# if __WORDSIZE == 64
+#  define UINT64_C(c)   c ## UL
+# else
+#  define UINT64_C(c)   c ## ULL
+# endif
+#endif
+
 #define CMD_LEN 256
 #define MAX_ARGS 64
 
Index: LVM2.2.02.47/lib/report/report.c
===================================================================
--- LVM2.2.02.47.orig/lib/report/report.c
+++ LVM2.2.02.47/lib/report/report.c
@@ -24,6 +24,11 @@
 #include "str_list.h"
 #include "lvmcache.h"
 
+#ifdef __dietlibc__
+#define __UINT64_C(c) c ## ULL
+# define UINT64_MAX             (__UINT64_C(18446744073709551615))
+#endif
+
 struct lvm_report_object {
 	struct volume_group *vg;
 	struct logical_volume *lv;
Index: LVM2.2.02.47/tools/dmsetup.c
===================================================================
--- LVM2.2.02.47.orig/tools/dmsetup.c
+++ LVM2.2.02.47/tools/dmsetup.c
@@ -40,6 +40,21 @@
 #include <fcntl.h>
 #include <sys/stat.h>
 
+#ifdef __dietlibc__
+# include <limits.h>
+# if __WORDSIZE == 64
+#  define INT64_C(c)    c ## L
+# else
+#  define INT64_C(c)    c ## LL
+# endif
+# define UINT32_C(c)    c ## U
+# if __WORDSIZE == 64
+#  define UINT64_C(c)   c ## UL
+# else
+#  define UINT64_C(c)   c ## ULL
+# endif
+#endif
+
 /* FIXME Unused so far */
 #undef HAVE_SYS_STATVFS_H
 
Index: LVM2.2.02.47/tools/Makefile.in
===================================================================
--- LVM2.2.02.47.orig/tools/Makefile.in
+++ LVM2.2.02.47/tools/Makefile.in
@@ -107,7 +107,7 @@ device-mapper: $(TARGETS_DM)
 
 dmsetup: dmsetup.o $(top_srcdir)/libdm/libdevmapper.$(LIB_SUFFIX)
 	$(CC) -o $@ dmsetup.o $(CFLAGS) $(LDFLAGS) \
-	      -L$(top_srcdir)/libdm -ldevmapper $(LIBS)
+	      -L$(interfacedir) -L$(top_srcdir)/libdm -ldevmapper $(LIBS)
 
 dmsetup.static: dmsetup.o $(interfacedir)/libdevmapper.a
 	$(CC) -o $@ dmsetup.o $(CFLAGS) $(LDFLAGS) -static \
@@ -118,7 +118,7 @@ all: device-mapper
 
 lvm: $(OBJECTS) lvm.o $(top_srcdir)/lib/liblvm-internal.a
 	$(CC) -o $@ $(CFLAGS) $(OBJECTS) lvm.o \
-		$(LDFLAGS) $(LVMLIBS) $(LIBS) -rdynamic
+		-L$(interfacedir) $(LDFLAGS) $(LVMLIBS) $(LIBS) -rdynamic
 
 LIB_PTHREAD = @LIB_PTHREAD@
 lvm.static: $(OBJECTS) lvm-static.o $(top_srcdir)/lib/liblvm-internal.a  $(interfacedir)/libdevmapper.a
