--- libspeex/speex_header.c.orig	2005-03-29 09:40:13.000000000 +0300
+++ libspeex/speex_header.c	2008-05-01 16:06:19.000000000 +0300
@@ -161,6 +161,13 @@
    ENDIAN_SWITCH(le_header->frames_per_packet);
    ENDIAN_SWITCH(le_header->extra_headers);
 
+   if (le_header->mode >= SPEEX_NB_MODES || le_header->mode < 0)
+   {
+      speex_warning("Invalid mode specified in Speex header");
+      speex_free (le_header);
+      return NULL;
+   }
+
    return le_header;
 
 }
