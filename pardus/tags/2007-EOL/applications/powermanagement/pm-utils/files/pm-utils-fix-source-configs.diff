Index: pm/functions
===================================================================
RCS file: /cvs/pm-utils/pm-utils/pm/functions,v
retrieving revision 1.28
diff -u -r1.28 functions
--- pm/functions	31 Oct 2006 17:52:16 -0000	1.28
+++ pm/functions	8 Nov 2006 11:30:52 -0000
@@ -26,16 +26,15 @@
 
 source_configs()
 {
-	for cfg in $(ls -1 /etc/pm/config.d/* 2>/dev/null) ; do
-		[[ "$cfg" =~ ".*~$" ]] && continue
-		STR=". $cfg"
-		for v in $GLOBAL_CONFIG_VARIABLES ; do
-			STR="$STR ; echo x_$v=\"\$(eval echo \$$v)\""
-		done
-		eval $(bash -c "$STR")
-		for v in $GLOBAL_CONFIG_VARIABLES ; do
-			eval $v="$(eval echo $(eval echo \$$v) \$x_$v)"
-		done
+	cfgs="/etc/pm/config.d/*[^~]"
+	for cfg in $cfgs ; do
+		[ -x $cfg ] || continue
+		while read LINE ; do
+			case "$GLOBAL_CONFIG_VARIABLES " in
+				*" ${LINE%=*} "*) continue ;;
+				*) eval $LINE ;;
+			esac
+		done < $cfg
 	done
 }
 
