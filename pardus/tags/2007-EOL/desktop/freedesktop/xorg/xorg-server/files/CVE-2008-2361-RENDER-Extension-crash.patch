From 87e94198432603d1ede6d4dabb34f8617e84c18b Mon Sep 17 00:00:00 2001
From: Matthieu Herrb <matthieu.herrb@laas.fr>
Date: Tue, 10 Jun 2008 12:22:30 -0600
Subject: [PATCH] CVE-2008-2361 - RENDER Extension crash

An integer overflow may occur in the computation of the size of the
glyph to be allocated by the ProcRenderCreateCursor() function which
will cause less memory to be allocated than expected, leading later to
dereferencing un-mapped memory, causing a crash of the X server.
(cherry picked from commit 5257a0f83d5f3d80d0cd44dd76d047bac3869592)
---
 render/render.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/render/render.c b/render/render.c
index 55f360a..d7dd80c 100644
--- xorg-server-1.3.0.0/render/render.c
+++ xorg-server-1.3.0.0/render/render.c
@@ -1502,6 +1502,8 @@ ProcRenderCreateCursor (ClientPtr client)
     pScreen = pSrc->pDrawable->pScreen;
     width = pSrc->pDrawable->width;
     height = pSrc->pDrawable->height;
+    if (height && width > UINT32_MAX/(height*sizeof(CARD32)))
+	return BadAlloc;
     if ( stuff->x > width 
       || stuff->y > height )
 	return (BadMatch);
-- 
1.5.3.7

