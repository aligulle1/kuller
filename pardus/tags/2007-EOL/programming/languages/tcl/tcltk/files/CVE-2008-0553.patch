--- ../generic/tkImgGIF.c	2007/12/13 15:24:14	1.40
+++ ../generic/tkImgGIF.c	2008/02/01 16:53:53	1.41
@@ -879,6 +879,12 @@
 		Tcl_PosixError(interp), NULL);
 	return TCL_ERROR;
     }
+
+    if (initialCodeSize > MAX_LWZ_BITS) {
+	Tcl_SetResult(interp, "malformed image", TCL_STATIC);
+	return TCL_ERROR;
+    }
+
     if (transparent != -1) {
 	cmap[transparent][CM_RED] = 0;
 	cmap[transparent][CM_GREEN] = 0;
