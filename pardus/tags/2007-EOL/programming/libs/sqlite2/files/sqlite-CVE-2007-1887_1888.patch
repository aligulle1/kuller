--- src/encode.c	2005/09/07 15:11:32	1.5.4.1
+++ src/encode.c	2006/12/24 20:50:02	1.5.4.1.2.1
@@ -176,9 +176,12 @@
   int i, e;
   unsigned char c;
   e = *(in++);
+  if (e == 0) {
+    return 0;
+  }
   i = 0;
   while( (c = *(in++))!=0 ){
-    if( c==1 ){
+    if (c == 1) {
       c = *(in++) - 1;
     }
     out[i++] = c + e;
