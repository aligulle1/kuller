--- sql/log.cc	2007-11-15 16:07:10.000000000 +0200
+++ sql/log.cc	2007-12-11 21:54:47.000000000 +0200
@@ -448,13 +448,9 @@
 {
   if (!log_name || !log_name[0])
   {
-    /*
-      TODO: The following should be using fn_format();  We just need to
-      first change fn_format() to cut the file name if it's too long.
-    */
-    strmake(buff, pidfile_name,FN_REFLEN-5);
-    strmov(fn_ext(buff),suffix);
-    return (const char *)buff;
+    strmake(buff, pidfile_name, FN_REFLEN - strlen(suffix) - 1);
+    return (const char *)
+      fn_format(buff, buff, "", suffix, MYF(MY_REPLACE_EXT|MY_REPLACE_DIR));
   }
   // get rid of extension if the log is binary to avoid problems
   if (strip_ext)
