--- src/kadmin/server/server_stubs.c	2006-04-13 21:58:56.000000000 +0300
+++ src/kadmin/server/server_stubs.c	2007-06-26 22:04:54.000000000 +0300
@@ -501,13 +501,14 @@
     static generic_ret		ret;
     char			*prime_arg1,
 				*prime_arg2;
-    char			prime_arg[BUFSIZ];
     gss_buffer_desc		client_name,
 				service_name;
     OM_uint32			minor_stat;
     kadm5_server_handle_t	handle;
     restriction_t		*rp;
     char                        *errmsg;
+    size_t			tlen1, tlen2, clen, slen;
+    char			*tdots1, *tdots2, *cdots, *sdots;
 
     xdr_free(xdr_generic_ret, &ret);
 
@@ -528,7 +529,14 @@
 	 ret.code = KADM5_BAD_PRINCIPAL;
 	 goto exit_func;
     }
-    sprintf(prime_arg, "%s to %s", prime_arg1, prime_arg2);
+    tlen1 = strlen(prime_arg1);
+    trunc_name(&tlen1, &tdots1);
+    tlen2 = strlen(prime_arg2);
+    trunc_name(&tlen2, &tdots2);
+    clen = client_name.length;
+    trunc_name(&clen, &cdots);
+    slen = service_name.length;
+    trunc_name(&slen, &sdots);
 
     ret.code = KADM5_OK;
     if (! CHANGEPW_SERVICE(rqstp)) {
@@ -546,9 +554,14 @@
     } else
 	 ret.code = KADM5_AUTH_INSUFFICIENT;
     if (ret.code != KADM5_OK) {
-	 krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, "kadm5_rename_principal",
-		prime_arg, client_name.value, service_name.value,
-		inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));
+	 krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, "Unauthorized request: kadm5_rename_principal,",
+    "%.*s%s to %.*s%s, "
+    "client=%.*s%s, service=%.*s%s, addr=%s",
+     tlen1, prime_arg1, tdots1,
+     tlen2, prime_arg2, tdots2,
+     clen, client_name.value, cdots,
+     slen, service_name.value, sdots,
+     inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));
     } else {
 	 ret.code = kadm5_rename_principal((void *)handle, arg->src,
 						arg->dest);
@@ -557,10 +570,15 @@
 	 else
 	     errmsg = krb5_get_error_message(handle ? handle->context : NULL, ret.code);
 
-	 krb5_klog_syslog(LOG_NOTICE, LOG_DONE, "kadm5_rename_principal",
-		prime_arg, errmsg,
-		client_name.value, service_name.value,
-		inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));
+	 krb5_klog_syslog(LOG_NOTICE, LOG_DONE,
+     "Request: kadm5_rename_principal, "
+     "%.*s%s to %.*s%s, %s, "
+     "client=%.*s%s, service=%.*s%s, addr=%s",
+     tlen1, prime_arg1, tdots1,
+     tlen2, prime_arg2, tdots2, errmsg,
+     clen, client_name.value, cdots,
+     slen, service_name.value, sdots,
+     inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));
     }
     free_server_handle(handle);
     free(prime_arg1);
--- src/kadmin/server/server_stubs.c	2007-06-26 22:05:53.000000000 +0300
+++ src/kadmin/server/server_stubs.c	2007-06-26 22:09:45.000000000 +0300
@@ -29,6 +29,15 @@
 			gss_oldchangepw_name)))
 
 
+#define MAXPRINCLEN 125
+
+void
+trunc_name(size_t *len, char **dots)
+{
+   *dots = *len > MAXPRINCLEN ? "..." : "";
+   *len = *len > MAXPRINCLEN ? MAXPRINCLEN : *len;
+}
+
 static int gss_to_krb5_name(kadm5_server_handle_t handle,
 		     gss_name_t gss_name, krb5_principal *princ);
 
