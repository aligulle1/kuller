--- src/mngutil.c	2003-06-04 15:23:12.000000000 +0300
+++ src/mngutil.c	2006-09-22 01:08:12.000000000 +0300
@@ -30,15 +30,23 @@
 #include <png.h>
 #include "mngutil.h"
 
-extern void png_write_data (png_structp png_ptr,
-				png_bytep data,png_size_t length);
-extern void png_save_uint_32 (png_bytep buf, png_uint_32 i);
-extern void png_save_uint_16 (png_bytep buf, png_uint_16 i);
-extern void png_write_chunk (png_structp png_ptr,
-				png_bytep chunk_name, png_bytep data, png_size_t length);
-
 png_byte mng_sig[8] = {138, 77, 78, 71, 13, 10, 26, 10};
 
+/* Write the data to whatever output you are using.  The default routine
+   writes to a file pointer.  Note that this routine sometimes gets called
+   with very small lengths, so you should implement some kind of simple
+   buffering if you are using unbuffered writes.  This should never be asked
+   to write more than 64K on a 16 bit machine.  */
+
+void /* PRIVATE */
+png_write_data(png_structp png_ptr, png_bytep data, png_size_t length)
+{
+  if (png_ptr->write_data_fn != NULL )
+    (*(png_ptr->write_data_fn))(png_ptr, data, length);
+  else
+    png_error(png_ptr, "Call to NULL write function");
+}
+
 /*
  * write MNG signature
  */
