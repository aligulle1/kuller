--- Zend/zend_ini.c	4 Jan 2006 23:53:04 -0000	1.39.2.2
+++ Zend/zend_ini.c	6 Sep 2006 08:54:23 -0000	1.39.2.3
@@ -256,8 +256,8 @@
 	zend_ini_entry *ini_entry;
 	TSRMLS_FETCH();
 
-	if (zend_hash_find(EG(ini_directives), name, name_length, (void **) &ini_entry)==FAILURE) {
-		return FAILURE;
+	if (zend_hash_find(EG(ini_directives), name, name_length, (void **) &ini_entry)==FAILURE ||
+	    (stage == ZEND_INI_STAGE_RUNTIME && (ini_entry->modifiable & ZEND_INI_USER) == 0)) {		return FAILURE;
 	}
 
 	zend_restore_ini_entry_cb(ini_entry, stage TSRMLS_CC);
