--- client.orig/scripts/linux   2006-09-07 18:53:10.476329752 +0100
+++ client/scripts/linux    2006-09-07 19:18:57.000000000 +0100
@@ -23,22 +23,22 @@
 # of the $1 in its args.
 
 make_resolv_conf() {
-  if [ x"$new_domain_name_servers" != x ]; then
-    cat /dev/null > /etc/resolv.conf.dhclient
-    chmod 644 /etc/resolv.conf.dhclient
-    if [ x"$new_domain_search" != x ]; then
-      echo search $new_domain_search >> /etc/resolv.conf.dhclient
-    elif [ x"$new_domain_name" != x ]; then
-      # Note that the DHCP 'Domain Name Option' is really just a domain
-      # name, and that this practice of using the domain name option as
-      # a search path is both nonstandard and deprecated.
-      echo search $new_domain_name >> /etc/resolv.conf.dhclient
+  if [ x$PEER_DNS = x ] || [ x$PEER_DNS = xyes ]; then
+    if [ "x$new_domain_name" != x ] || [ "x$new_domain_name_servers" != x ]; then
+      conf="# Generated by dhclient for interface $interface\n"
+      if [ "x$new_domain_name" != x ]; then
+        conf="${conf}search $new_domain_name\n"
+      fi
+      for nameserver in $new_domain_name_servers; do
+        conf="${conf}nameserver $nameserver\n"
+      done
+      if [ -x /sbin/resolvconf ]; then
+        echo -e "$conf" | resolvconf -a "$interface"
+      else
+        echo -e "$conf" > /etc/resolv.conf
+        chmod 644 /etc/resolv.conf
+      fi
     fi
-    for nameserver in $new_domain_name_servers; do
-      echo nameserver $nameserver >>/etc/resolv.conf.dhclient
-    done
-
-    mv /etc/resolv.conf.dhclient /etc/resolv.conf
   fi
   # If we're making confs, may as well make an ntp.conf too
   make_ntp_conf
