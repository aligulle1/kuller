diff -Nur clamav-0.93.3/freshclam/manager.c clamav-0.93.3-new/freshclam/manager.c
--- clamav-0.93.3/freshclam/manager.c	2008-07-03 15:27:00.000000000 +0300
+++ clamav-0.93.3-new/freshclam/manager.c	2008-09-05 12:24:35.000000000 +0300
@@ -357,10 +357,12 @@
 
 	if(user) {
 	    authorization = proxyauth(user, pass);
-	    if(!authorization)
-		return NULL;
+	    if(!authorization){
+            free(remotename);
+		    return NULL;
 	}
     }
+    }
 
     if(stat(file, &sb) != -1 && sb.st_mtime < time(NULL)) {
 	Rfc2822DateTime(last_modified, sb.st_mtime);
@@ -522,10 +524,12 @@
 
 	if(user) {
 	    authorization = proxyauth(user, pass);
-	    if(!authorization)
+	    if(!authorization){
+		free(remotename);
 		return 75; /* FIXME */
 	}
     }
+    }
 
     if(uas)
 	agent = uas;
@@ -546,6 +550,12 @@
 	"Connection: close\r\n"
 	"\r\n", (remotename != NULL) ? remotename : "", srcfile, hostname, (authorization != NULL) ? authorization : "", agent);
 
+    if(remotename)
+        free(remotename);
+
+    if(authorization)
+        free(authorization);
+
     memset(ipaddr, 0, sizeof(ipaddr));
 
     if(ip[0]) /* use ip to connect */
@@ -568,12 +578,6 @@
 	return 52;
     }
 
-    if(remotename)
-	free(remotename);
-
-    if(authorization)
-	free(authorization);
-
     /* read http headers */
     ch = buffer;
     i = 0;
