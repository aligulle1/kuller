--- src/dbusinterface.cpp	1969-12-31 16:00:00.000000000 -0800
+++ src/dbusinterface.cpp	2007-06-24 19:52:23.000000000 -0700
@@ -0,0 +1,51 @@
+/***************************************************************************
+ *   Copyright (C) 2007 by                                                 *
+ *      İsmail Dönmez <ismail@pardus.org.tr>                               *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   51 Franklin Steet, Fifth Floor, Boston, MA  02111-1307, USA.          *
+ ***************************************************************************/
+
+#include <QtDBus/QtDBus>
+
+#include "dbusinterface.h"
+
+DBusInterface::DBusInterface()
+{
+  QDBusConnection::sessionBus().registerService("com.lastfm.DBusInterface");
+  QDBusConnection::sessionBus().registerObject("/", this, QDBusConnection::ExportAllSlots);
+}
+
+void DBusInterface::setNewSong(const MetaData& metaData )
+{
+  m_artist = metaData.artist();
+  m_album  = metaData.album();
+  m_track  = metaData.track();
+}
+
+QString DBusInterface::currentArtist()
+{
+  return m_artist;
+}
+
+QString DBusInterface::currentAlbum()
+{
+  return m_album;
+}
+
+QString DBusInterface::currentTrack()
+{
+  return m_track;
+}
--- src/dbusinterface.h	1969-12-31 16:00:00.000000000 -0800
+++ src/dbusinterface.h	2007-06-24 19:30:06.000000000 -0700
@@ -0,0 +1,49 @@
+/***************************************************************************
+ *   Copyright (C) 2007 by                                                 *
+ *      İsmail Dönmez <ismail@pardus.org.tr>                               *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   51 Franklin Steet, Fifth Floor, Boston, MA  02111-1307, USA.          *
+ ***************************************************************************/
+
+#ifndef DBUSINTERFACE_H
+#define DBUSINTERFACE_H
+
+#ifdef LINUX
+
+#include <QtCore/QObject>
+#include "metadata.h"
+
+class DBusInterface: public QObject
+{
+ Q_OBJECT
+
+ public:
+  DBusInterface();
+  void setNewSong(const MetaData& );
+
+ public slots:
+  Q_SCRIPTABLE QString currentArtist();
+  Q_SCRIPTABLE QString currentAlbum();
+  Q_SCRIPTABLE QString currentTrack();
+
+ private:
+  QString m_artist, m_album, m_track;
+
+};
+
+#endif // LINUX
+
+#endif // DBUSINTERFACE_H
--- src/container.cpp	2007-12-05 14:39:28.000000000 +0200
+++ src/container.cpp	2007-12-11 15:55:04.000000000 +0200
@@ -55,6 +55,7 @@
 #include "volumeslider.h"
 #include "WebService.h"
 #include "WebService/Request.h"
+#include "dbusinterface.h"
 
 #include <QShortcut>
 #include <QLabel>
@@ -95,6 +96,11 @@
     loadExtensions();
     setupConnections();
     restoreState();
+
+#ifdef LINUX
+    m_dbusInterface = new DBusInterface();
+#endif
+
 }
 
 
@@ -1765,6 +1771,7 @@
         {
             MetaData metadata = data.value<MetaData>();
 
+            m_dbusInterface->setNewSong(metadata);
             updateWindowTitle( metadata );
             ui.metaDataWidget->setTrackMetaData( metadata );
 
--- src/container.h	2007-12-05 14:39:27.000000000 +0200
+++ src/container.h	2007-12-11 15:56:38.000000000 +0200
@@ -113,6 +113,11 @@
         QStyle* m_styleOverrides;
         #endif
 
+#ifdef LINUX
+        class DBusInterface* m_dbusInterface;
+#endif
+
+
     private slots:
         void setupTrayIcon();
         void about();
--- src/src.pro	2007-12-11 15:58:23.000000000 +0200
+++ src/src.pro	2007-12-11 15:59:36.000000000 +0200
@@ -14,6 +14,7 @@
 unix {
     # precompiled headers breaks icecream builds for some reason :(
     system( test `ps aux | grep iceccd | wc -l` -gt 1 ): CONFIG -= precompile_header
+    CONFIG += qdbus
 }
 
 #universal binaries cannot be built from precompiled headers
@@ -202,10 +203,12 @@
              wizardshell_mac.ui
 
     HEADERS += simplewizard_mac.h \
-               winstyleoverrides.h
+               winstyleoverrides.h \
+               dbusinterface.h
 
     SOURCES += simplewizard_mac.cpp \
-               winstyleoverrides.cpp
+               winstyleoverrides.cpp \
+               dbusinterface.cpp
 
     LIBS -= -lLastFmFingerprint$$EXT
 }
