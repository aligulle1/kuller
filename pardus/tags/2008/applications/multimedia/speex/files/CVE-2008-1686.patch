--- libspeex/speex_header.c.orig	2007-11-25 09:51:47.000000000 +0200
+++ libspeex/speex_header.c	2008-05-01 15:57:03.000000000 +0300
@@ -178,6 +178,13 @@
    ENDIAN_SWITCH(le_header->frames_per_packet);
    ENDIAN_SWITCH(le_header->extra_headers);
 
+   if (le_header->mode >= SPEEX_NB_MODES || le_header->mode < 0)
+   {
+      speex_notify("Invalid mode specified in Speex header");
+      speex_free (le_header);
+      return NULL;
+   }
+
    return le_header;
 
 }
