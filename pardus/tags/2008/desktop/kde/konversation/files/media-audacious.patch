--- konversation/scripts/media	2007-12-10 21:35:46.000000000 +0200
+++ konversation/scripts/media	2007-12-10 21:37:40.000000000 +0200
@@ -48,7 +48,7 @@
 ## If you add a new player, you must add it here or it won't get checked when in audio-only or video-only modes.
 playerRankings= {
     'video' :['kaffeine', 'noatun', 'kdetv'],
-    'audio' :['Amarok', 'JuK', 'Noatun', 'Kaffeine', 'kscd', 'XMMS', 'Yammi', 'LastFM']
+    'audio' :['Amarok', 'JuK', 'Noatun', 'Kaffeine', 'kscd', 'XMMS', 'Yammi', 'LastFM', 'Audacious']
 }
 
 ## Title, album and artist fields to be quoted depending on contents
@@ -279,6 +279,27 @@
         album = subprocess.Popen(["qdbus","com.lastfm.DBusInterface","/","currentAlbum"], stdout=subprocess.PIPE).communicate()[0].rstrip()
         return (title,artist,album)
 
+class AudaciousPlayer(Player):
+    def __init__(self, display_name):
+        Player.__init__(self, display_name)
+
+    def isRunning(self):
+        self.running = not os.system('audtool current-song')
+        return self.running
+
+    def getData(self):
+        if self.isRunning() and not os.system('audtool playback-playing'):
+            # get the title of the currently playing track
+            data = os.popen('audtool current-song').read().strip()
+            new_list = data.split(' - ')
+            list_length = len(new_list)
+            if list_length == 1:
+                return (self.reEncodeString(new_list[0]),'','')
+            if list_length == 3:
+                return (self.reEncodeString(new_list[-1]),new_list[0],new_list[1])
+            else:
+                return (self.reEncodeString(data),'','')
+
 def playing(playerList, mode=None):
     for i in playerList:
         s=i.get(mode)
@@ -342,6 +363,7 @@
 DCOPPlayer("Yammi","yammi","YammiPlayer songTitle","YammiPlayer songArtist","YammiPlayer songAlbum"),
 DCOPPlayer("kdetv","kdetv","KdetvIface channelName",playerType='video'),
 LastFMPlayer(),
+AudaciousPlayer('Audacious'),
 ]
 
 # Get rid of players that didn't get subclassed so they don't appear in the available players list
