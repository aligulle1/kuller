Index: templates/add-printer.tmpl
===================================================================
--- templates/add-printer.tmpl	(revision 2066)
+++ templates/add-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {device_uri?<INPUT TYPE="HIDDEN" NAME="DEVICE_URI" VALUE="{device_uri}">:}
 
Index: templates/choose-model.tmpl
===================================================================
--- templates/choose-model.tmpl	(revision 2066)
+++ templates/choose-model.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/ja/add-printer.tmpl
===================================================================
--- templates/ja/add-printer.tmpl	(revision 2066)
+++ templates/ja/add-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {device_uri?<INPUT TYPE="HIDDEN" NAME="DEVICE_URI" VALUE="{device_uri}">:}
 
Index: templates/ja/job-move.tmpl
===================================================================
--- templates/ja/job-move.tmpl	(revision 2066)
+++ templates/ja/job-move.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/{SECTION}/{job_id?:{printer_name}}">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {job_id?<INPUT TYPE="HIDDEN" NAME="JOB_ID" VALUE="{job_id}">:}
 
Index: templates/ja/choose-model.tmpl
===================================================================
--- templates/ja/choose-model.tmpl	(revision 2066)
+++ templates/ja/choose-model.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/ja/edit-config.tmpl
===================================================================
--- templates/ja/edit-config.tmpl	(revision 2066)
+++ templates/ja/edit-config.tmpl	(revision 2067)
@@ -8,7 +8,7 @@
 <H2 CLASS="title">サーバ設定ファイル</H2>
 
 <FORM NAME="cups" METHOD="POST" ACTION="/admin/">
-
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="config-server">
 
 <TEXTAREA NAME="CUPSDCONF" COLS="80" ROWS="25">{CUPSDCONF}</TEXTAREA>
Index: templates/ja/add-class.tmpl
===================================================================
--- templates/ja/add-class.tmpl	(revision 2066)
+++ templates/ja/add-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">クラスの追加</H2>
Index: templates/ja/choose-serial.tmpl
===================================================================
--- templates/ja/choose-serial.tmpl	(revision 2066)
+++ templates/ja/choose-serial.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/ja/samba-export.tmpl
===================================================================
--- templates/ja/samba-export.tmpl	(revision 2066)
+++ templates/ja/samba-export.tmpl	(revision 2067)
@@ -10,6 +10,7 @@
 --></SCRIPT>
 
 <FORM METHOD="POST" ACTION="/admin/" NAME="export_samba">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="export-samba">
 
 <H2 CLASS="title">プリンタを Samba にエキスポート</H2>
Index: templates/ja/modify-printer.tmpl
===================================================================
--- templates/ja/modify-printer.tmpl	(revision 2066)
+++ templates/ja/modify-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {?device_uri=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_DEVICE_URI" VALUE="{device_uri}">}
 {?printer_make_and_model=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_MAKE_AND_MODEL" VALUE="{printer_make_and_model}">}
Index: templates/ja/choose-device.tmpl
===================================================================
--- templates/ja/choose-device.tmpl	(revision 2066)
+++ templates/ja/choose-device.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/ja/choose-uri.tmpl
===================================================================
--- templates/ja/choose-uri.tmpl	(revision 2066)
+++ templates/ja/choose-uri.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/ja/add-rss-subscription.tmpl
===================================================================
--- templates/ja/add-rss-subscription.tmpl	(revision 2066)
+++ templates/ja/add-rss-subscription.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="add-rss-subscription">
 
 <H2 CLASS="title">RSS 購読を追加</H2>
Index: templates/ja/admin.tmpl
===================================================================
--- templates/ja/admin.tmpl	(revision 2066)
+++ templates/ja/admin.tmpl	(revision 2067)
@@ -53,6 +53,7 @@
 <BLOCKQUOTE>{SETTINGS_ERROR}</BLOCKQUOTE>:
 
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 
 <P><B>基本サーバ設定:</B></P>
 
Index: templates/ja/modify-class.tmpl
===================================================================
--- templates/ja/modify-class.tmpl	(revision 2066)
+++ templates/ja/modify-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">クラス {printer_name} の変更</H2>
Index: templates/ja/choose-make.tmpl
===================================================================
--- templates/ja/choose-make.tmpl	(revision 2066)
+++ templates/ja/choose-make.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/ja/users.tmpl
===================================================================
--- templates/ja/users.tmpl	(revision 2066)
+++ templates/ja/users.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{OP}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 {IS_CLASS?<INPUT TYPE="HIDDEN" NAME="IS_CLASS" VALUE="{IS_CLASS}">:}
Index: templates/fr/add-printer.tmpl
===================================================================
--- templates/fr/add-printer.tmpl	(revision 2066)
+++ templates/fr/add-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {device_uri?<INPUT TYPE="HIDDEN" NAME="DEVICE_URI" VALUE="{device_uri}">:}
 
Index: templates/fr/job-move.tmpl
===================================================================
--- templates/fr/job-move.tmpl	(revision 2066)
+++ templates/fr/job-move.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/{SECTION}/{job_id?:{printer_name}}">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {job_id?<INPUT TYPE="HIDDEN" NAME="JOB_ID" VALUE="{job_id}">:}
 
Index: templates/fr/choose-model.tmpl
===================================================================
--- templates/fr/choose-model.tmpl	(revision 2066)
+++ templates/fr/choose-model.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/fr/edit-config.tmpl
===================================================================
--- templates/fr/edit-config.tmpl	(revision 2066)
+++ templates/fr/edit-config.tmpl	(revision 2067)
@@ -8,7 +8,7 @@
 <H2 CLASS="title">Ficher de configuration du serveur</H2>
 
 <FORM NAME="cups" METHOD="POST" ACTION="/admin/">
-
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="config-server">
 
 <TEXTAREA NAME="CUPSDCONF" COLS="80" ROWS="25">{CUPSDCONF}</TEXTAREA>
Index: templates/fr/set-printer-options-header.tmpl
===================================================================
--- templates/fr/set-printer-options-header.tmpl	(revision 2066)
+++ templates/fr/set-printer-options-header.tmpl	(revision 2067)
@@ -1,3 +1,4 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
Index: templates/fr/add-class.tmpl
===================================================================
--- templates/fr/add-class.tmpl	(revision 2066)
+++ templates/fr/add-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">Ajouter une classe</H2>
Index: templates/fr/choose-serial.tmpl
===================================================================
--- templates/fr/choose-serial.tmpl	(revision 2066)
+++ templates/fr/choose-serial.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/fr/samba-export.tmpl
===================================================================
--- templates/fr/samba-export.tmpl	(revision 2066)
+++ templates/fr/samba-export.tmpl	(revision 2067)
@@ -10,6 +10,7 @@
 --></SCRIPT>
 
 <FORM METHOD="POST" ACTION="/admin/" NAME="export_samba">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="export-samba">
 
 <H2 CLASS="title">Exporter des imprimantes vers SAMBA</H2>
Index: templates/fr/modify-printer.tmpl
===================================================================
--- templates/fr/modify-printer.tmpl	(revision 2066)
+++ templates/fr/modify-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {?device_uri=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_DEVICE_URI" VALUE="{device_uri}">}
 {?printer_make_and_model=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_MAKE_AND_MODEL" VALUE="{printer_make_and_model}">}
Index: templates/fr/choose-device.tmpl
===================================================================
--- templates/fr/choose-device.tmpl	(revision 2066)
+++ templates/fr/choose-device.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/fr/choose-uri.tmpl
===================================================================
--- templates/fr/choose-uri.tmpl	(revision 2066)
+++ templates/fr/choose-uri.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/fr/admin.tmpl
===================================================================
--- templates/fr/admin.tmpl	(revision 2066)
+++ templates/fr/admin.tmpl	(revision 2067)
@@ -55,6 +55,7 @@
 <BLOCKQUOTE>{SETTINGS_ERROR}</BLOCKQUOTE>:
 
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 
 <P><B>Paramètres de base du serveur :</B></P>
 
Index: templates/fr/modify-class.tmpl
===================================================================
--- templates/fr/modify-class.tmpl	(revision 2066)
+++ templates/fr/modify-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">Modifier la classe {printer_name}</H2>
Index: templates/fr/choose-make.tmpl
===================================================================
--- templates/fr/choose-make.tmpl	(revision 2066)
+++ templates/fr/choose-make.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/fr/users.tmpl
===================================================================
--- templates/fr/users.tmpl	(revision 2066)
+++ templates/fr/users.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{OP}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 {IS_CLASS?<INPUT TYPE="HIDDEN" NAME="IS_CLASS" VALUE="{IS_CLASS}">:}
Index: templates/samba-export.tmpl
===================================================================
--- templates/samba-export.tmpl	(revision 2066)
+++ templates/samba-export.tmpl	(revision 2067)
@@ -10,6 +10,7 @@
 --></SCRIPT>
 
 <FORM METHOD="POST" ACTION="/admin/" NAME="export_samba">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="export-samba">
 
 <H2 CLASS="title">Export Printers to Samba</H2>
Index: templates/modify-printer.tmpl
===================================================================
--- templates/modify-printer.tmpl	(revision 2066)
+++ templates/modify-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {?device_uri=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_DEVICE_URI" VALUE="{device_uri}">}
 {?printer_make_and_model=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_MAKE_AND_MODEL" VALUE="{printer_make_and_model}">}
Index: templates/choose-device.tmpl
===================================================================
--- templates/choose-device.tmpl	(revision 2066)
+++ templates/choose-device.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/zh_TW/add-printer.tmpl
===================================================================
--- templates/zh_TW/add-printer.tmpl	(revision 2066)
+++ templates/zh_TW/add-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">加入新的印表機</H2>
Index: templates/zh_TW/job-move.tmpl
===================================================================
--- templates/zh_TW/job-move.tmpl	(revision 2066)
+++ templates/zh_TW/job-move.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/{SECTION}/{job_id?:{printer_name}}">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {job_id?<INPUT TYPE="HIDDEN" NAME="JOB_ID" VALUE="{job_id}">:}
 
Index: templates/zh_TW/choose-model.tmpl
===================================================================
--- templates/zh_TW/choose-model.tmpl	(revision 2066)
+++ templates/zh_TW/choose-model.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/zh_TW/edit-config.tmpl
===================================================================
--- templates/zh_TW/edit-config.tmpl	(revision 2066)
+++ templates/zh_TW/edit-config.tmpl	(revision 2067)
@@ -8,7 +8,7 @@
 <H2 CLASS="title">伺服器配置檔案</H2>
 
 <FORM NAME="cups" METHOD="POST" ACTION="/admin/">
-
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="config-server">
 
 <TEXTAREA NAME="CUPSDCONF" COLS="80" ROWS="25">{CUPSDCONF}</TEXTAREA>
Index: templates/zh_TW/set-printer-options-header.tmpl
===================================================================
--- templates/zh_TW/set-printer-options-header.tmpl	(revision 2066)
+++ templates/zh_TW/set-printer-options-header.tmpl	(revision 2067)
@@ -1,3 +1,4 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
Index: templates/zh_TW/add-class.tmpl
===================================================================
--- templates/zh_TW/add-class.tmpl	(revision 2066)
+++ templates/zh_TW/add-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">加入分類</H2>
Index: templates/zh_TW/choose-serial.tmpl
===================================================================
--- templates/zh_TW/choose-serial.tmpl	(revision 2066)
+++ templates/zh_TW/choose-serial.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/zh_TW/samba-export.tmpl
===================================================================
--- templates/zh_TW/samba-export.tmpl	(revision 2066)
+++ templates/zh_TW/samba-export.tmpl	(revision 2067)
@@ -10,6 +10,7 @@
 --></SCRIPT>
 
 <FORM METHOD="POST" ACTION="/admin/" NAME="export_samba">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="export-samba">
 
 <H2 CLASS="title">匯出印表機至 Samba</H2>
Index: templates/zh_TW/modify-printer.tmpl
===================================================================
--- templates/zh_TW/modify-printer.tmpl	(revision 2066)
+++ templates/zh_TW/modify-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {?device_uri=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_DEVICE_URI" VALUE="{device_uri}">}
 {?printer_make_and_model=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_MAKE_AND_MODEL" VALUE="{printer_make_and_model}">}
Index: templates/zh_TW/choose-device.tmpl
===================================================================
--- templates/zh_TW/choose-device.tmpl	(revision 2066)
+++ templates/zh_TW/choose-device.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/zh_TW/choose-uri.tmpl
===================================================================
--- templates/zh_TW/choose-uri.tmpl	(revision 2066)
+++ templates/zh_TW/choose-uri.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/zh_TW/admin.tmpl
===================================================================
--- templates/zh_TW/admin.tmpl	(revision 2066)
+++ templates/zh_TW/admin.tmpl	(revision 2067)
@@ -59,6 +59,7 @@
 <BLOCKQUOTE>{SETTINGS_ERROR}</BLOCKQUOTE>:
 
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 
 <P><B>基本伺服器設定值：</B></P>
 
Index: templates/zh_TW/modify-class.tmpl
===================================================================
--- templates/zh_TW/modify-class.tmpl	(revision 2066)
+++ templates/zh_TW/modify-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">修改分類 {printer_name}</H2>
Index: templates/zh_TW/choose-make.tmpl
===================================================================
--- templates/zh_TW/choose-make.tmpl	(revision 2066)
+++ templates/zh_TW/choose-make.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/zh_TW/users.tmpl
===================================================================
--- templates/zh_TW/users.tmpl	(revision 2066)
+++ templates/zh_TW/users.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{OP}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 {IS_CLASS?<INPUT TYPE="HIDDEN" NAME="IS_CLASS" VALUE="{IS_CLASS}">:}
Index: templates/admin.tmpl
===================================================================
--- templates/admin.tmpl	(revision 2066)
+++ templates/admin.tmpl	(revision 2067)
@@ -55,6 +55,7 @@
 <BLOCKQUOTE>{SETTINGS_ERROR}</BLOCKQUOTE>:
 
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 
 <P><B>Basic Server Settings:</B></P>
 
Index: templates/modify-class.tmpl
===================================================================
--- templates/modify-class.tmpl	(revision 2066)
+++ templates/modify-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">Modify Class {printer_name}</H2>
Index: templates/choose-make.tmpl
===================================================================
--- templates/choose-make.tmpl	(revision 2066)
+++ templates/choose-make.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/users.tmpl
===================================================================
--- templates/users.tmpl	(revision 2066)
+++ templates/users.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{OP}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 {IS_CLASS?<INPUT TYPE="HIDDEN" NAME="IS_CLASS" VALUE="{IS_CLASS}">:}
Index: templates/sv/add-printer.tmpl
===================================================================
--- templates/sv/add-printer.tmpl	(revision 2066)
+++ templates/sv/add-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {device_uri?<INPUT TYPE="HIDDEN" NAME="DEVICE_URI" VALUE="{device_uri}">:}
 
Index: templates/sv/job-move.tmpl
===================================================================
--- templates/sv/job-move.tmpl	(revision 2066)
+++ templates/sv/job-move.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/{SECTION}/{job_id?:{printer_name}}">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {job_id?<INPUT TYPE="HIDDEN" NAME="JOB_ID" VALUE="{job_id}">:}
 
Index: templates/sv/choose-model.tmpl
===================================================================
--- templates/sv/choose-model.tmpl	(revision 2066)
+++ templates/sv/choose-model.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/sv/edit-config.tmpl
===================================================================
--- templates/sv/edit-config.tmpl	(revision 2066)
+++ templates/sv/edit-config.tmpl	(revision 2067)
@@ -8,7 +8,7 @@
 <H2 CLASS="title">Serverkonfigurationsfil</H2>
 
 <FORM NAME="cups" METHOD="POST" ACTION="/admin/">
-
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="config-server">
 
 <TEXTAREA NAME="CUPSDCONF" COLS="80" ROWS="25">{CUPSDCONF}</TEXTAREA>
Index: templates/sv/set-printer-options-header.tmpl
===================================================================
--- templates/sv/set-printer-options-header.tmpl	(revision 2066)
+++ templates/sv/set-printer-options-header.tmpl	(revision 2067)
@@ -1,3 +1,4 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
Index: templates/sv/add-class.tmpl
===================================================================
--- templates/sv/add-class.tmpl	(revision 2066)
+++ templates/sv/add-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">Lägg till klass</H2>
Index: templates/sv/choose-serial.tmpl
===================================================================
--- templates/sv/choose-serial.tmpl	(revision 2066)
+++ templates/sv/choose-serial.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/sv/samba-export.tmpl
===================================================================
--- templates/sv/samba-export.tmpl	(revision 2066)
+++ templates/sv/samba-export.tmpl	(revision 2067)
@@ -10,6 +10,7 @@
 --></SCRIPT>
 
 <FORM METHOD="POST" ACTION="/admin/" NAME="export_samba">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="export-samba">
 
 <H2 CLASS="title">Exportera skrivare till Samba</H2>
Index: templates/sv/modify-printer.tmpl
===================================================================
--- templates/sv/modify-printer.tmpl	(revision 2066)
+++ templates/sv/modify-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {?device_uri=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_DEVICE_URI" VALUE="{device_uri}">}
 {?printer_make_and_model=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_MAKE_AND_MODEL" VALUE="{printer_make_and_model}">}
Index: templates/sv/choose-device.tmpl
===================================================================
--- templates/sv/choose-device.tmpl	(revision 2066)
+++ templates/sv/choose-device.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/sv/choose-uri.tmpl
===================================================================
--- templates/sv/choose-uri.tmpl	(revision 2066)
+++ templates/sv/choose-uri.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/sv/admin.tmpl
===================================================================
--- templates/sv/admin.tmpl	(revision 2066)
+++ templates/sv/admin.tmpl	(revision 2067)
@@ -59,6 +59,7 @@
 <BLOCKQUOTE>{SETTINGS_ERROR}</BLOCKQUOTE>:
 
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 
 <P><B>Grundläggande serverinställningar:</B></P>
 
Index: templates/sv/modify-class.tmpl
===================================================================
--- templates/sv/modify-class.tmpl	(revision 2066)
+++ templates/sv/modify-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">Modifiera klass {printer_name}</H2>
Index: templates/sv/choose-make.tmpl
===================================================================
--- templates/sv/choose-make.tmpl	(revision 2066)
+++ templates/sv/choose-make.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/sv/users.tmpl
===================================================================
--- templates/sv/users.tmpl	(revision 2066)
+++ templates/sv/users.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{OP}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 {IS_CLASS?<INPUT TYPE="HIDDEN" NAME="IS_CLASS" VALUE="{IS_CLASS}">:}
Index: templates/de/add-printer.tmpl
===================================================================
--- templates/de/add-printer.tmpl	(revision 2066)
+++ templates/de/add-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {device_uri?<INPUT TYPE="HIDDEN" NAME="DEVICE_URI" VALUE="{device_uri}">:}
 
Index: templates/de/choose-model.tmpl
===================================================================
--- templates/de/choose-model.tmpl	(revision 2066)
+++ templates/de/choose-model.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/de/samba-export.tmpl
===================================================================
--- templates/de/samba-export.tmpl	(revision 2066)
+++ templates/de/samba-export.tmpl	(revision 2067)
@@ -10,6 +10,7 @@
 --></SCRIPT>
 
 <FORM METHOD="POST" ACTION="/admin/" NAME="export_samba">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="export-samba">
 
 <H2 CLASS="title">Exportiere Drucker f&uuml;r Samba</H2>
Index: templates/de/modify-printer.tmpl
===================================================================
--- templates/de/modify-printer.tmpl	(revision 2066)
+++ templates/de/modify-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {?device_uri=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_DEVICE_URI" VALUE="{device_uri}">}
 {?printer_make_and_model=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_MAKE_AND_MODEL" VALUE="{printer_make_and_model}">}
Index: templates/de/choose-device.tmpl
===================================================================
--- templates/de/choose-device.tmpl	(revision 2066)
+++ templates/de/choose-device.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/de/admin.tmpl
===================================================================
--- templates/de/admin.tmpl	(revision 2066)
+++ templates/de/admin.tmpl	(revision 2067)
@@ -55,6 +55,7 @@
 <BLOCKQUOTE>{SETTINGS_ERROR}</BLOCKQUOTE>:
 
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 
 <P><B>Grundlegende Servereinstellungen:</B></P>
 
Index: templates/de/modify-class.tmpl
===================================================================
--- templates/de/modify-class.tmpl	(revision 2066)
+++ templates/de/modify-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">Klasse {printer_name} &auml;ndern</H2>
Index: templates/de/choose-make.tmpl
===================================================================
--- templates/de/choose-make.tmpl	(revision 2066)
+++ templates/de/choose-make.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/de/users.tmpl
===================================================================
--- templates/de/users.tmpl	(revision 2066)
+++ templates/de/users.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{OP}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 {IS_CLASS?<INPUT TYPE="HIDDEN" NAME="IS_CLASS" VALUE="{IS_CLASS}">:}
Index: templates/de/job-move.tmpl
===================================================================
--- templates/de/job-move.tmpl	(revision 2066)
+++ templates/de/job-move.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/{SECTION}/{job_id?:{printer_name}}">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {job_id?<INPUT TYPE="HIDDEN" NAME="JOB_ID" VALUE="{job_id}">:}
 
Index: templates/de/edit-config.tmpl
===================================================================
--- templates/de/edit-config.tmpl	(revision 2066)
+++ templates/de/edit-config.tmpl	(revision 2067)
@@ -8,7 +8,7 @@
 <H2 CLASS="title">Server Konfigurationsdatei</H2>
 
 <FORM NAME="cups" METHOD="POST" ACTION="/admin/">
-
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="config-server">
 
 <TEXTAREA NAME="CUPSDCONF" COLS="80" ROWS="25">{CUPSDCONF}</TEXTAREA>
Index: templates/de/add-class.tmpl
===================================================================
--- templates/de/add-class.tmpl	(revision 2066)
+++ templates/de/add-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">Klasse hinzuf&uuml;gen</H2>
Index: templates/de/set-printer-options-header.tmpl
===================================================================
--- templates/de/set-printer-options-header.tmpl	(revision 2066)
+++ templates/de/set-printer-options-header.tmpl	(revision 2067)
@@ -1,3 +1,4 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
Index: templates/de/choose-serial.tmpl
===================================================================
--- templates/de/choose-serial.tmpl	(revision 2066)
+++ templates/de/choose-serial.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/de/choose-uri.tmpl
===================================================================
--- templates/de/choose-uri.tmpl	(revision 2066)
+++ templates/de/choose-uri.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/de/add-rss-subscription.tmpl
===================================================================
--- templates/de/add-rss-subscription.tmpl	(revision 2066)
+++ templates/de/add-rss-subscription.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="add-rss-subscription">
 
 <H2 CLASS="title">RSS Subskription hinzuf&uuml;gen</H2>
Index: templates/job-move.tmpl
===================================================================
--- templates/job-move.tmpl	(revision 2066)
+++ templates/job-move.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/{SECTION}/{job_id?:{printer_name}}">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {job_id?<INPUT TYPE="HIDDEN" NAME="JOB_ID" VALUE="{job_id}">:}
 
Index: templates/he/add-printer.tmpl
===================================================================
--- templates/he/add-printer.tmpl	(revision 2066)
+++ templates/he/add-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">הוסף מדפסת חדשה</H2>
Index: templates/he/job-move.tmpl
===================================================================
--- templates/he/job-move.tmpl	(revision 2066)
+++ templates/he/job-move.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/{SECTION}/{job_id?:{printer_name}}">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {job_id?<INPUT TYPE="HIDDEN" NAME="JOB_ID" VALUE="{job_id}">:}
 
Index: templates/he/choose-model.tmpl
===================================================================
--- templates/he/choose-model.tmpl	(revision 2066)
+++ templates/he/choose-model.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/he/edit-config.tmpl
===================================================================
--- templates/he/edit-config.tmpl	(revision 2066)
+++ templates/he/edit-config.tmpl	(revision 2067)
@@ -8,7 +8,7 @@
 <H2 CLASS="title">קובץ הגדרות של השרת</H2>
 
 <FORM NAME="cups" METHOD="POST" ACTION="/admin/">
-
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="config-server">
 
 <TEXTAREA NAME="CUPSDCONF" COLS="80" ROWS="25" dir=ltr>{CUPSDCONF}</TEXTAREA>
Index: templates/he/set-printer-options-header.tmpl
===================================================================
--- templates/he/set-printer-options-header.tmpl	(revision 2066)
+++ templates/he/set-printer-options-header.tmpl	(revision 2067)
@@ -1,3 +1,4 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
Index: templates/he/add-class.tmpl
===================================================================
--- templates/he/add-class.tmpl	(revision 2066)
+++ templates/he/add-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">הוסף מחלקה</H2>
Index: templates/he/choose-serial.tmpl
===================================================================
--- templates/he/choose-serial.tmpl	(revision 2066)
+++ templates/he/choose-serial.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/he/samba-export.tmpl
===================================================================
--- templates/he/samba-export.tmpl	(revision 2066)
+++ templates/he/samba-export.tmpl	(revision 2067)
@@ -10,6 +10,7 @@
 --></SCRIPT>
 
 <FORM METHOD="POST" ACTION="/admin/" NAME="export_samba">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="export-samba">
 
 <H2 CLASS="title">ייצא מדפסות ל Samba</H2>
Index: templates/he/modify-printer.tmpl
===================================================================
--- templates/he/modify-printer.tmpl	(revision 2066)
+++ templates/he/modify-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {?device_uri=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_DEVICE_URI" VALUE="{device_uri}">}
 {?printer_make_and_model=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_MAKE_AND_MODEL" VALUE="{printer_make_and_model}">}
Index: templates/he/choose-device.tmpl
===================================================================
--- templates/he/choose-device.tmpl	(revision 2066)
+++ templates/he/choose-device.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/he/choose-uri.tmpl
===================================================================
--- templates/he/choose-uri.tmpl	(revision 2066)
+++ templates/he/choose-uri.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/he/admin.tmpl
===================================================================
--- templates/he/admin.tmpl	(revision 2066)
+++ templates/he/admin.tmpl	(revision 2067)
@@ -59,6 +59,7 @@
 <BLOCKQUOTE>{SETTINGS_ERROR}</BLOCKQUOTE>:
 
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 
 <P><B>הגדרות שרת בסיסיות:</B></P>
 
Index: templates/he/modify-class.tmpl
===================================================================
--- templates/he/modify-class.tmpl	(revision 2066)
+++ templates/he/modify-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">שנה מחלקה {printer_name}</H2>
Index: templates/he/choose-make.tmpl
===================================================================
--- templates/he/choose-make.tmpl	(revision 2066)
+++ templates/he/choose-make.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/he/users.tmpl
===================================================================
--- templates/he/users.tmpl	(revision 2066)
+++ templates/he/users.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{OP}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 {IS_CLASS?<INPUT TYPE="HIDDEN" NAME="IS_CLASS" VALUE="{IS_CLASS}">:}
Index: templates/edit-config.tmpl
===================================================================
--- templates/edit-config.tmpl	(revision 2066)
+++ templates/edit-config.tmpl	(revision 2067)
@@ -8,7 +8,7 @@
 <H2 CLASS="title">Server Configuration File</H2>
 
 <FORM NAME="cups" METHOD="POST" ACTION="/admin/">
-
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="config-server">
 
 <TEXTAREA NAME="CUPSDCONF" COLS="80" ROWS="25">{CUPSDCONF}</TEXTAREA>
Index: templates/set-printer-options-header.tmpl
===================================================================
--- templates/set-printer-options-header.tmpl	(revision 2066)
+++ templates/set-printer-options-header.tmpl	(revision 2067)
@@ -1,3 +1,4 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
Index: templates/add-class.tmpl
===================================================================
--- templates/add-class.tmpl	(revision 2066)
+++ templates/add-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">Add Class</H2>
Index: templates/choose-serial.tmpl
===================================================================
--- templates/choose-serial.tmpl	(revision 2066)
+++ templates/choose-serial.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/pl/add-printer.tmpl
===================================================================
--- templates/pl/add-printer.tmpl	(revision 2066)
+++ templates/pl/add-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {device_uri?<INPUT TYPE="HIDDEN" NAME="DEVICE_URI" VALUE="{device_uri}">:}
 
Index: templates/pl/job-move.tmpl
===================================================================
--- templates/pl/job-move.tmpl	(revision 2066)
+++ templates/pl/job-move.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/{SECTION}/{job_id?:{printer_name}}">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {job_id?<INPUT TYPE="HIDDEN" NAME="JOB_ID" VALUE="{job_id}">:}
 
Index: templates/pl/choose-model.tmpl
===================================================================
--- templates/pl/choose-model.tmpl	(revision 2066)
+++ templates/pl/choose-model.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/pl/edit-config.tmpl
===================================================================
--- templates/pl/edit-config.tmpl	(revision 2066)
+++ templates/pl/edit-config.tmpl	(revision 2067)
@@ -8,7 +8,7 @@
 <H2 CLASS="title">Plik Konfiguracji Serwera</H2>
 
 <FORM NAME="cups" METHOD="POST" ACTION="/admin/">
-
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="config-server">
 
 <TEXTAREA NAME="CUPSDCONF" COLS="80" ROWS="25">{CUPSDCONF}</TEXTAREA>
Index: templates/pl/set-printer-options-header.tmpl
===================================================================
--- templates/pl/set-printer-options-header.tmpl	(revision 2066)
+++ templates/pl/set-printer-options-header.tmpl	(revision 2067)
@@ -1,3 +1,4 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
Index: templates/pl/add-class.tmpl
===================================================================
--- templates/pl/add-class.tmpl	(revision 2066)
+++ templates/pl/add-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">Dodaj klasę</H2>
Index: templates/pl/choose-serial.tmpl
===================================================================
--- templates/pl/choose-serial.tmpl	(revision 2066)
+++ templates/pl/choose-serial.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/pl/samba-export.tmpl
===================================================================
--- templates/pl/samba-export.tmpl	(revision 2066)
+++ templates/pl/samba-export.tmpl	(revision 2067)
@@ -10,6 +10,7 @@
 --></SCRIPT>
 
 <FORM METHOD="POST" ACTION="/admin/" NAME="export_samba">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="export-samba">
 
 <H2 CLASS="title">Wyeksportuj drukarki do Samby</H2>
Index: templates/pl/modify-printer.tmpl
===================================================================
--- templates/pl/modify-printer.tmpl	(revision 2066)
+++ templates/pl/modify-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {?device_uri=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_DEVICE_URI" VALUE="{device_uri}">}
 {?printer_make_and_model=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_MAKE_AND_MODEL" VALUE="{printer_make_and_model}">}
Index: templates/pl/choose-device.tmpl
===================================================================
--- templates/pl/choose-device.tmpl	(revision 2066)
+++ templates/pl/choose-device.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/pl/choose-uri.tmpl
===================================================================
--- templates/pl/choose-uri.tmpl	(revision 2066)
+++ templates/pl/choose-uri.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/pl/admin.tmpl
===================================================================
--- templates/pl/admin.tmpl	(revision 2066)
+++ templates/pl/admin.tmpl	(revision 2067)
@@ -57,6 +57,7 @@
 <BLOCKQUOTE>{SETTINGS_ERROR}</BLOCKQUOTE>:
 
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 
 <P><B>Podstawowe ustawienia serwera:</B></P>
 
Index: templates/pl/modify-class.tmpl
===================================================================
--- templates/pl/modify-class.tmpl	(revision 2066)
+++ templates/pl/modify-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">Zmodyfikuj klasę {printer_name}</H2>
Index: templates/pl/choose-make.tmpl
===================================================================
--- templates/pl/choose-make.tmpl	(revision 2066)
+++ templates/pl/choose-make.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/pl/users.tmpl
===================================================================
--- templates/pl/users.tmpl	(revision 2066)
+++ templates/pl/users.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{OP}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 {IS_CLASS?<INPUT TYPE="HIDDEN" NAME="IS_CLASS" VALUE="{IS_CLASS}">:}
Index: templates/choose-uri.tmpl
===================================================================
--- templates/choose-uri.tmpl	(revision 2066)
+++ templates/choose-uri.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/add-rss-subscription.tmpl
===================================================================
--- templates/add-rss-subscription.tmpl	(revision 2066)
+++ templates/add-rss-subscription.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="add-rss-subscription">
 
 <H2 CLASS="title">Add RSS Subscription</H2>
Index: templates/id/add-printer.tmpl
===================================================================
--- templates/id/add-printer.tmpl	(revision 2066)
+++ templates/id/add-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {device_uri?<INPUT TYPE="HIDDEN" NAME="DEVICE_URI" VALUE="{device_uri}">:}
 
Index: templates/id/choose-model.tmpl
===================================================================
--- templates/id/choose-model.tmpl	(revision 2066)
+++ templates/id/choose-model.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/id/samba-export.tmpl
===================================================================
--- templates/id/samba-export.tmpl	(revision 2066)
+++ templates/id/samba-export.tmpl	(revision 2067)
@@ -10,6 +10,7 @@
 --></SCRIPT>
 
 <FORM METHOD="POST" ACTION="/admin/" NAME="export_samba">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="export-samba">
 
 <H2 CLASS="title">Mengekspor Pencetak melalui Samba</H2>
Index: templates/id/modify-printer.tmpl
===================================================================
--- templates/id/modify-printer.tmpl	(revision 2066)
+++ templates/id/modify-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {?device_uri=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_DEVICE_URI" VALUE="{device_uri}">}
 {?printer_make_and_model=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_MAKE_AND_MODEL" VALUE="{printer_make_and_model}">}
Index: templates/id/choose-device.tmpl
===================================================================
--- templates/id/choose-device.tmpl	(revision 2066)
+++ templates/id/choose-device.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/id/admin.tmpl
===================================================================
--- templates/id/admin.tmpl	(revision 2066)
+++ templates/id/admin.tmpl	(revision 2067)
@@ -53,6 +53,7 @@
 <BLOCKQUOTE>{SETTINGS_ERROR}</BLOCKQUOTE>:
 
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 
 <P><B>Pengaturan Dasar <I>Server</I>:</B></P>
 
Index: templates/id/modify-class.tmpl
===================================================================
--- templates/id/modify-class.tmpl	(revision 2066)
+++ templates/id/modify-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">Mengubah Kelas {printer_name}</H2>
Index: templates/id/choose-make.tmpl
===================================================================
--- templates/id/choose-make.tmpl	(revision 2066)
+++ templates/id/choose-make.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/id/users.tmpl
===================================================================
--- templates/id/users.tmpl	(revision 2066)
+++ templates/id/users.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{OP}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 {IS_CLASS?<INPUT TYPE="HIDDEN" NAME="IS_CLASS" VALUE="{IS_CLASS}">:}
Index: templates/id/job-move.tmpl
===================================================================
--- templates/id/job-move.tmpl	(revision 2066)
+++ templates/id/job-move.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/{SECTION}/{job_id?:{printer_name}}">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {job_id?<INPUT TYPE="HIDDEN" NAME="JOB_ID" VALUE="{job_id}">:}
 
Index: templates/id/edit-config.tmpl
===================================================================
--- templates/id/edit-config.tmpl	(revision 2066)
+++ templates/id/edit-config.tmpl	(revision 2067)
@@ -8,7 +8,7 @@
 <H2 CLASS="title">Berkas Konfigurasi <i>Server</i></H2>
 
 <FORM NAME="cups" METHOD="POST" ACTION="/admin/">
-
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="config-server">
 
 <TEXTAREA NAME="CUPSDCONF" COLS="80" ROWS="25">{CUPSDCONF}</TEXTAREA>
Index: templates/id/add-class.tmpl
===================================================================
--- templates/id/add-class.tmpl	(revision 2066)
+++ templates/id/add-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">Tambah Kelas</H2>
Index: templates/id/set-printer-options-header.tmpl
===================================================================
--- templates/id/set-printer-options-header.tmpl	(revision 2066)
+++ templates/id/set-printer-options-header.tmpl	(revision 2067)
@@ -1,3 +1,4 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
Index: templates/id/choose-serial.tmpl
===================================================================
--- templates/id/choose-serial.tmpl	(revision 2066)
+++ templates/id/choose-serial.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/id/choose-uri.tmpl
===================================================================
--- templates/id/choose-uri.tmpl	(revision 2066)
+++ templates/id/choose-uri.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/id/add-rss-subscription.tmpl
===================================================================
--- templates/id/add-rss-subscription.tmpl	(revision 2066)
+++ templates/id/add-rss-subscription.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="add-rss-subscription">
 
 <H2 CLASS="title">Tambah Berlangganan RSS</H2>
Index: templates/es/add-printer.tmpl
===================================================================
--- templates/es/add-printer.tmpl	(revision 2066)
+++ templates/es/add-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {device_uri?<INPUT TYPE="HIDDEN" NAME="DEVICE_URI" VALUE="{device_uri}">:}
 
Index: templates/es/choose-model.tmpl
===================================================================
--- templates/es/choose-model.tmpl	(revision 2066)
+++ templates/es/choose-model.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/es/samba-export.tmpl
===================================================================
--- templates/es/samba-export.tmpl	(revision 2066)
+++ templates/es/samba-export.tmpl	(revision 2067)
@@ -10,6 +10,7 @@
 --></SCRIPT>
 
 <FORM METHOD="POST" ACTION="/admin/" NAME="export_samba">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="export-samba">
 
 <H2 CLASS="title">Exportar impresoras a Samba</H2>
Index: templates/es/modify-printer.tmpl
===================================================================
--- templates/es/modify-printer.tmpl	(revision 2066)
+++ templates/es/modify-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {?device_uri=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_DEVICE_URI" VALUE="{device_uri}">}
 {?printer_make_and_model=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_MAKE_AND_MODEL" VALUE="{printer_make_and_model}">}
Index: templates/es/choose-device.tmpl
===================================================================
--- templates/es/choose-device.tmpl	(revision 2066)
+++ templates/es/choose-device.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/es/admin.tmpl
===================================================================
--- templates/es/admin.tmpl	(revision 2066)
+++ templates/es/admin.tmpl	(revision 2067)
@@ -55,6 +55,7 @@
 <BLOCKQUOTE>{SETTINGS_ERROR}</BLOCKQUOTE>:
 
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 
 <P><B>Configuraci&oacute;n b&aacute;sica del servidor:</B></P>
 
Index: templates/es/modify-class.tmpl
===================================================================
--- templates/es/modify-class.tmpl	(revision 2066)
+++ templates/es/modify-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">Modificar clase {printer_name}</H2>
Index: templates/es/choose-make.tmpl
===================================================================
--- templates/es/choose-make.tmpl	(revision 2066)
+++ templates/es/choose-make.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/es/users.tmpl
===================================================================
--- templates/es/users.tmpl	(revision 2066)
+++ templates/es/users.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{OP}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 {IS_CLASS?<INPUT TYPE="HIDDEN" NAME="IS_CLASS" VALUE="{IS_CLASS}">:}
Index: templates/es/job-move.tmpl
===================================================================
--- templates/es/job-move.tmpl	(revision 2066)
+++ templates/es/job-move.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/{SECTION}/{job_id?:{printer_name}}">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {job_id?<INPUT TYPE="HIDDEN" NAME="JOB_ID" VALUE="{job_id}">:}
 
Index: templates/es/edit-config.tmpl
===================================================================
--- templates/es/edit-config.tmpl	(revision 2066)
+++ templates/es/edit-config.tmpl	(revision 2067)
@@ -8,7 +8,7 @@
 <H2 CLASS="title">Archivo de configuraci&oacute;n del servidor</H2>
 
 <FORM NAME="cups" METHOD="POST" ACTION="/admin/">
-
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="config-server">
 
 <TEXTAREA NAME="CUPSDCONF" COLS="80" ROWS="25">{CUPSDCONF}</TEXTAREA>
Index: templates/es/add-class.tmpl
===================================================================
--- templates/es/add-class.tmpl	(revision 2066)
+++ templates/es/add-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">A&ntilde;adir clase</H2>
Index: templates/es/set-printer-options-header.tmpl
===================================================================
--- templates/es/set-printer-options-header.tmpl	(revision 2066)
+++ templates/es/set-printer-options-header.tmpl	(revision 2067)
@@ -1,3 +1,4 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
Index: templates/es/choose-serial.tmpl
===================================================================
--- templates/es/choose-serial.tmpl	(revision 2066)
+++ templates/es/choose-serial.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/es/choose-uri.tmpl
===================================================================
--- templates/es/choose-uri.tmpl	(revision 2066)
+++ templates/es/choose-uri.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/es/add-rss-subscription.tmpl
===================================================================
--- templates/es/add-rss-subscription.tmpl	(revision 2066)
+++ templates/es/add-rss-subscription.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="add-rss-subscription">
 
 <H2 CLASS="title">A&ntilde;adir subscripci&oacute;n RSS</H2>
Index: templates/et/add-printer.tmpl
===================================================================
--- templates/et/add-printer.tmpl	(revision 2066)
+++ templates/et/add-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {device_uri?<INPUT TYPE="HIDDEN" NAME="DEVICE_URI" VALUE="{device_uri}">:}
 
Index: templates/et/choose-model.tmpl
===================================================================
--- templates/et/choose-model.tmpl	(revision 2066)
+++ templates/et/choose-model.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/et/edit-config.tmpl
===================================================================
--- templates/et/edit-config.tmpl	(revision 2066)
+++ templates/et/edit-config.tmpl	(revision 2067)
@@ -8,7 +8,7 @@
 <H2 CLASS="title">Serveri seadistustefail</H2>
 
 <FORM NAME="cups" METHOD="POST" ACTION="/admin/">
-
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="config-server">
 
 <TEXTAREA NAME="CUPSDCONF" COLS="80" ROWS="25">{CUPSDCONF}</TEXTAREA>
Index: templates/et/set-printer-options-header.tmpl
===================================================================
--- templates/et/set-printer-options-header.tmpl	(revision 2066)
+++ templates/et/set-printer-options-header.tmpl	(revision 2067)
@@ -1,3 +1,4 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
Index: templates/et/add-class.tmpl
===================================================================
--- templates/et/add-class.tmpl	(revision 2066)
+++ templates/et/add-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">Klassi lisamine</H2>
Index: templates/et/choose-serial.tmpl
===================================================================
--- templates/et/choose-serial.tmpl	(revision 2066)
+++ templates/et/choose-serial.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/et/samba-export.tmpl
===================================================================
--- templates/et/samba-export.tmpl	(revision 2066)
+++ templates/et/samba-export.tmpl	(revision 2067)
@@ -10,6 +10,7 @@
 --></SCRIPT>
 
 <FORM METHOD="POST" ACTION="/admin/" NAME="export_samba">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="export-samba">
 
 <H2 CLASS="title">Printerite eksport Sambasse</H2>
Index: templates/et/modify-printer.tmpl
===================================================================
--- templates/et/modify-printer.tmpl	(revision 2066)
+++ templates/et/modify-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {?device_uri=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_DEVICE_URI" VALUE="{device_uri}">}
 {?printer_make_and_model=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_MAKE_AND_MODEL" VALUE="{printer_make_and_model}">}
Index: templates/et/choose-device.tmpl
===================================================================
--- templates/et/choose-device.tmpl	(revision 2066)
+++ templates/et/choose-device.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/et/choose-uri.tmpl
===================================================================
--- templates/et/choose-uri.tmpl	(revision 2066)
+++ templates/et/choose-uri.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/et/admin.tmpl
===================================================================
--- templates/et/admin.tmpl	(revision 2066)
+++ templates/et/admin.tmpl	(revision 2067)
@@ -59,6 +59,7 @@
 <BLOCKQUOTE>{SETTINGS_ERROR}</BLOCKQUOTE>:
 
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 
 <P><B>Serveri põhiseadistused:</B></P>
 
Index: templates/et/modify-class.tmpl
===================================================================
--- templates/et/modify-class.tmpl	(revision 2066)
+++ templates/et/modify-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">Klassi {printer_name} muutmine</H2>
Index: templates/et/choose-make.tmpl
===================================================================
--- templates/et/choose-make.tmpl	(revision 2066)
+++ templates/et/choose-make.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/et/users.tmpl
===================================================================
--- templates/et/users.tmpl	(revision 2066)
+++ templates/et/users.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{OP}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 {IS_CLASS?<INPUT TYPE="HIDDEN" NAME="IS_CLASS" VALUE="{IS_CLASS}">:}
Index: templates/it/add-printer.tmpl
===================================================================
--- templates/it/add-printer.tmpl	(revision 2066)
+++ templates/it/add-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {device_uri?<INPUT TYPE="HIDDEN" NAME="DEVICE_URI" VALUE="{device_uri}">:}
 
Index: templates/it/job-move.tmpl
===================================================================
--- templates/it/job-move.tmpl	(revision 2066)
+++ templates/it/job-move.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/{SECTION}/{job_id?:{printer_name}}">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {job_id?<INPUT TYPE="HIDDEN" NAME="JOB_ID" VALUE="{job_id}">:}
 
Index: templates/it/choose-model.tmpl
===================================================================
--- templates/it/choose-model.tmpl	(revision 2066)
+++ templates/it/choose-model.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/it/edit-config.tmpl
===================================================================
--- templates/it/edit-config.tmpl	(revision 2066)
+++ templates/it/edit-config.tmpl	(revision 2067)
@@ -8,7 +8,7 @@
 <H2 CLASS="title">File di configurazione del server</H2>
 
 <FORM NAME="cups" METHOD="POST" ACTION="/admin/">
-
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="config-server">
 
 <TEXTAREA NAME="CUPSDCONF" COLS="80" ROWS="25">{CUPSDCONF}</TEXTAREA>
Index: templates/it/set-printer-options-header.tmpl
===================================================================
--- templates/it/set-printer-options-header.tmpl	(revision 2066)
+++ templates/it/set-printer-options-header.tmpl	(revision 2067)
@@ -1,3 +1,4 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
Index: templates/it/add-class.tmpl
===================================================================
--- templates/it/add-class.tmpl	(revision 2066)
+++ templates/it/add-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">Aggiungi classe</H2>
Index: templates/it/choose-serial.tmpl
===================================================================
--- templates/it/choose-serial.tmpl	(revision 2066)
+++ templates/it/choose-serial.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/it/samba-export.tmpl
===================================================================
--- templates/it/samba-export.tmpl	(revision 2066)
+++ templates/it/samba-export.tmpl	(revision 2067)
@@ -10,6 +10,7 @@
 --></SCRIPT>
 
 <FORM METHOD="POST" ACTION="/admin/" NAME="export_samba">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="export-samba">
 
 <H2 CLASS="title">Esporta stampanti su Samba</H2>
Index: templates/it/modify-printer.tmpl
===================================================================
--- templates/it/modify-printer.tmpl	(revision 2066)
+++ templates/it/modify-printer.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 {?device_uri=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_DEVICE_URI" VALUE="{device_uri}">}
 {?printer_make_and_model=?:<INPUT TYPE="HIDDEN" NAME="CURRENT_MAKE_AND_MODEL" VALUE="{printer_make_and_model}">}
Index: templates/it/choose-device.tmpl
===================================================================
--- templates/it/choose-device.tmpl	(revision 2066)
+++ templates/it/choose-device.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/it/choose-uri.tmpl
===================================================================
--- templates/it/choose-uri.tmpl	(revision 2066)
+++ templates/it/choose-uri.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/it/admin.tmpl
===================================================================
--- templates/it/admin.tmpl	(revision 2066)
+++ templates/it/admin.tmpl	(revision 2067)
@@ -59,6 +59,7 @@
 <BLOCKQUOTE>{SETTINGS_ERROR}</BLOCKQUOTE>:
 
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 
 <P><B>Impostazioni di base del server:</B></P>
 
Index: templates/it/modify-class.tmpl
===================================================================
--- templates/it/modify-class.tmpl	(revision 2066)
+++ templates/it/modify-class.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 
 <H2 CLASS="title">Modifica classe {printer_name}</H2>
Index: templates/it/choose-make.tmpl
===================================================================
--- templates/it/choose-make.tmpl	(revision 2066)
+++ templates/it/choose-make.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin" ENCTYPE="multipart/form-data">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{op}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_LOCATION" VALUE="{?printer_location}">
Index: templates/it/users.tmpl
===================================================================
--- templates/it/users.tmpl	(revision 2066)
+++ templates/it/users.tmpl	(revision 2067)
@@ -1,4 +1,5 @@
 <FORM METHOD="POST" ACTION="/admin">
+<INPUT TYPE="HIDDEN" NAME="org.cups.sid" VALUE="{$org.cups.sid}">
 <INPUT TYPE="HIDDEN" NAME="OP" VALUE="{OP}">
 <INPUT TYPE="HIDDEN" NAME="PRINTER_NAME" VALUE="{printer_name}">
 {IS_CLASS?<INPUT TYPE="HIDDEN" NAME="IS_CLASS" VALUE="{IS_CLASS}">:}
Index: cgi-bin/cgi.h
===================================================================
--- cgi-bin/cgi.h	(revision 2066)
+++ cgi-bin/cgi.h	(revision 2067)
@@ -3,7 +3,7 @@
  *
  *   CGI support library definitions.
  *
- *   Copyright 2007 by Apple Inc.
+ *   Copyright 2007-2010 by Apple Inc.
  *   Copyright 1997-2006 by Easy Software Products.
  *
  *   These coded instructions, statements, and computer programs are the
@@ -64,7 +64,7 @@
 extern void		cgiFreeSearch(void *search);
 extern const char	*cgiGetArray(const char *name, int element);
 extern void		cgiGetAttributes(ipp_t *request, const char *tmpl);
-extern char		*cgiGetCookie(const char *name, char *buf, int buflen);
+extern const char	*cgiGetCookie(const char *name);
 extern const cgi_file_t	*cgiGetFile(void);
 extern cups_array_t	*cgiGetIPPObjects(ipp_t *response, void *search);
 extern int		cgiGetSize(const char *name);
Index: cgi-bin/template.c
===================================================================
--- cgi-bin/template.c	(revision 2066)
+++ cgi-bin/template.c	(revision 2067)
@@ -257,7 +257,7 @@
       uriencode = 0;
 
       for (s = name; (ch = getc(in)) != EOF;)
-        if (strchr("}]<>=! \t\n", ch))
+        if (strchr("}]<>=!~ \t\n", ch))
           break;
 	else if (s == name && ch == '%')
 	  uriencode = 1;
@@ -367,6 +367,20 @@
 
         continue;
       }
+      else if (name[0] == '$')
+      {
+       /*
+        * Insert cookie value or nothing if not defined.
+	*/
+
+        if ((value = cgiGetCookie(name + 1)) != NULL)
+	  outptr = value;
+	else
+	{
+	  outval[0] = '\0';
+	  outptr    = outval;
+	}
+      }
       else
       {
        /*
@@ -434,7 +448,14 @@
         * Test for existance...
 	*/
 
-        result     = cgiGetArray(name, element) != NULL && outptr[0];
+        if (name[0] == '?')
+	  result = cgiGetArray(name + 1, element) != NULL;
+	else if (name[0] == '#')
+	  result = cgiGetVariable(name + 1) != NULL;
+        else
+          result = cgiGetArray(name, element) != NULL;
+
+	result     = result && outptr[0];
 	compare[0] = '\0';
       }
       else
Index: cgi-bin/ipp-var.c
===================================================================
--- cgi-bin/ipp-var.c	(revision 2066)
+++ cgi-bin/ipp-var.c	(revision 2067)
@@ -113,7 +113,7 @@
       */
 
       for (nameptr = name; (ch = getc(in)) != EOF;)
-        if (strchr("}]<>=! \t\n", ch))
+        if (strchr("}]<>=!~ \t\n", ch))
           break;
         else if (nameptr > name && ch == '?')
 	  break;
Index: cgi-bin/admin.c
===================================================================
--- cgi-bin/admin.c	(revision 2066)
+++ cgi-bin/admin.c	(revision 2067)
@@ -3,7 +3,7 @@
  *
  *   Administration CGI for the Common UNIX Printing System (CUPS).
  *
- *   Copyright 2007-2008 by Apple Inc.
+ *   Copyright 2007-2010 by Apple Inc.
  *   Copyright 1997-2007 by Easy Software Products.
  *
  *   These coded instructions, statements, and computer programs are the
@@ -110,7 +110,7 @@
   * See if we have form data...
   */
 
-  if (!cgiInitialize())
+  if (!cgiInitialize() || !cgiGetVariable("OP"))
   {
    /*
     * Nope, send the administration menu...
Index: cgi-bin/var.c
===================================================================
--- cgi-bin/var.c	(revision 2066)
+++ cgi-bin/var.c	(revision 2067)
@@ -3,7 +3,7 @@
  *
  *   CGI form variable and array functions.
  *
- *   Copyright 2007-2008 by Apple Inc.
+ *   Copyright 2007-2010 by Apple Inc.
  *   Copyright 1997-2005 by Easy Software Products.
  *
  *   These coded instructions, statements, and computer programs are the
@@ -40,9 +40,17 @@
 /*#define DEBUG*/
 #include "cgi-private.h"
 #include <errno.h>
+#include <cups/md5.h>
 
 
 /*
+ * Session ID name
+ */
+
+#define CUPS_SID	"org.cups.sid"
+
+
+/*
  * Data structure to hold all the CGI form variables and arrays...
  */
 
@@ -59,6 +67,8 @@
  * Local globals...
  */
 
+static int		num_cookies = 0;/* Number of cookies */
+static cups_option_t	*cookies = NULL;/* Cookies */
 static int		form_count = 0,	/* Form variable count */
 			form_alloc = 0;	/* Number of variables allocated */
 static _cgi_var_t	*form_vars = NULL;
@@ -76,11 +86,13 @@
 static int		cgi_compare_variables(const _cgi_var_t *v1,
 			                      const _cgi_var_t *v2);
 static _cgi_var_t	*cgi_find_variable(const char *name);
+static void		cgi_initialize_cookies(void);
 static int		cgi_initialize_get(void);
 static int		cgi_initialize_multipart(const char *boundary);
 static int		cgi_initialize_post(void);
 static int		cgi_initialize_string(const char *data);
 static const char	*cgi_passwd(const char *prompt);
+static const char	*cgi_set_sid(void);
 static void		cgi_sort_variables(void);
 static void		cgi_unlink_file(void);
 
@@ -185,6 +197,17 @@
 
 
 /*
+ * 'cgiGetCookie()' - Get a cookie value.
+ */
+
+const char *				/* O - Value or NULL */
+cgiGetCookie(const char *name)		/* I - Name of cookie */
+{
+  return (cupsGetOption(name, num_cookies, cookies));
+}
+
+
+/*
  * 'cgiGetFile()' - Get the file (if any) that was submitted in the form.
  */
 
@@ -248,6 +271,8 @@
 {
   const char	*method;		/* Form posting method */
   const char	*content_type;		/* Content-Type of post data */
+  const char	*cups_sid_cookie,	/* SID cookie */
+		*cups_sid_form;		/* SID form variable */
 
 
  /*
@@ -272,6 +297,20 @@
 #endif /* DEBUG */
 
  /*
+  * Get cookies...
+  */
+
+  cgi_initialize_cookies();
+
+  if ((cups_sid_cookie = cgiGetCookie(CUPS_SID)) == NULL)
+  {
+    fputs("DEBUG: " CUPS_SID " cookie not found, initializing!\n", stderr);
+    cups_sid_cookie = cgi_set_sid();
+  }
+
+  fprintf(stderr, "DEBUG: " CUPS_SID " cookie is \"%s\"\n", cups_sid_cookie);
+
+ /*
   * Get the request method (GET or POST)...
   */
 
@@ -294,9 +333,27 @@
       boundary += 9;
 
     if (content_type && !strncmp(content_type, "multipart/form-data; ", 21))
-      return (cgi_initialize_multipart(boundary));
+    {
+      if (!cgi_initialize_multipart(boundary))
+        return (0);
+    }
+    else if (!cgi_initialize_post())
+      return (0);
+
+    if ((cups_sid_form = cgiGetVariable(CUPS_SID)) == NULL ||
+	strcmp(cups_sid_cookie, cups_sid_form))
+    {
+      if (cups_sid_form)
+	fprintf(stderr, "DEBUG: " CUPS_SID " form variable is \"%s\"\n",
+	        cups_sid_form);
+      else
+	fputs("DEBUG: " CUPS_SID " form variable is not present.\n", stderr);
+
+      cgiClearVariables();
+      return (0);
+    }
     else
-      return (cgi_initialize_post());
+      return (1);
   }
   else
     return (0);
@@ -375,6 +432,38 @@
 
 
 /*
+ * 'cgiSetCookie()' - Set a cookie value.
+ */
+
+void
+cgiSetCookie(const char *name,		/* I - Name */
+             const char *value,		/* I - Value */
+             const char *path,		/* I - Path (typically "/") */
+	     const char *domain,	/* I - Domain name */
+	     time_t     expires,	/* I - Expiration date (0 for session) */
+	     int        secure)		/* I - Require SSL */
+{
+  num_cookies = cupsAddOption(name, value, num_cookies, &cookies);
+
+  printf("Set-Cookie: %s=%s", name, value);
+  if (path)
+    printf("; path=%s", path);
+  if (domain)
+    printf("; domain=%s", domain);
+  if (expires)
+  {
+    char	date[256];		/* Date string */
+
+    printf("; expires=%s", httpGetDateString2(expires, date, sizeof(date)));
+  }
+  if (secure)
+    puts("; secure;");
+  else
+    puts(";");
+}
+
+
+/*
  * 'cgiSetSize()' - Set the array size.
  */
 
@@ -539,6 +628,96 @@
 
 
 /*
+ * 'cgi_initialize_cookies()' - Initialize cookies.
+ */
+
+static void
+cgi_initialize_cookies(void)
+{
+  const char	*cookie;		/* HTTP_COOKIE environment variable */
+  char		name[128],		/* Name string */
+		value[512],		/* Value string */
+		*ptr;			/* Pointer into name/value */
+
+
+  if ((cookie = getenv("HTTP_COOKIE")) == NULL)
+  {
+    fputs("DEBUG: HTTP_COOKIE not defined.\n", stderr);
+    return;
+  }
+
+  fprintf(stderr, "DEBUG: HTTP_COOKIE=\"%s\"\n", cookie);
+
+  while (*cookie)
+  {
+   /*
+    * Skip leading whitespace...
+    */
+
+    while (isspace(*cookie & 255))
+      cookie ++;
+    if (!*cookie)
+      break;
+
+   /*
+    * Copy the name...
+    */
+
+    for (ptr = name; *cookie && *cookie != '=';)
+      if (ptr < (name + sizeof(name) - 1))
+        *ptr++ = *cookie++;
+      else
+        break;
+
+    if (*cookie != '=')
+      break;
+
+    *ptr = '\0';
+    cookie ++;
+
+   /*
+    * Then the value...
+    */
+
+    if (*cookie == '\"')
+    {
+      for (cookie ++, ptr = value; *cookie && *cookie != '\"';)
+        if (ptr < (value + sizeof(value) - 1))
+	  *ptr++ = *cookie++;
+	else
+	  break;
+
+      if (*cookie == '\"')
+        cookie ++;
+    }
+    else
+    {
+      for (ptr = value; *cookie && *cookie != ';';)
+        if (ptr < (value + sizeof(value) - 1))
+	  *ptr++ = *cookie++;
+	else
+	  break;
+    }
+
+    if (*cookie == ';')
+      cookie ++;
+    else if (*cookie)
+      break;
+
+    *ptr = '\0';
+
+   /*
+    * Then add the cookie to an array as long as the name doesn't start with
+    * "$"...
+    */
+
+    if (name[0] != '$')
+      num_cookies = cupsAddOption(name, value, num_cookies, &cookies);
+  }
+}
+
+
+/*
  * 'cgi_initialize_get()' - Initialize form variables using the GET method.
  */
 
@@ -1024,6 +1203,46 @@
 
 
 /*
+ * 'cgi_set_sid()' - Set the CUPS session ID.
+ */
+
+static const char *			/* O - New session ID */
+cgi_set_sid(void)
+{
+  char			buffer[512],	/* SID data */
+			sid[33];	/* SID string */
+  _cups_md5_state_t	md5;		/* MD5 state */
+  unsigned char		sum[16];	/* MD5 sum */
+  const char		*remote_addr,	/* REMOTE_ADDR */
+			*server_name,	/* SERVER_NAME */
+			*server_port;	/* SERVER_PORT */
+
+
+  if ((remote_addr = getenv("REMOTE_ADDR")) == NULL)
+    remote_addr = "REMOTE_ADDR";
+  if ((server_name = getenv("SERVER_NAME")) == NULL)
+    server_name = "SERVER_NAME";
+  if ((server_port = getenv("SERVER_PORT")) == NULL)
+    server_port = "SERVER_PORT";
+
+  srand(time(NULL));
+  snprintf(buffer, sizeof(buffer), "%s:%s:%s:%02X%02X%02X%02X%02X%02X%02X%02X",
+           remote_addr, server_name, server_port,
+	   (unsigned)rand() & 255, (unsigned)rand() & 255,
+	   (unsigned)rand() & 255, (unsigned)rand() & 255,
+	   (unsigned)rand() & 255, (unsigned)rand() & 255,
+	   (unsigned)rand() & 255, (unsigned)rand() & 255);
+  _cupsMD5Init(&md5);
+  _cupsMD5Append(&md5, (unsigned char *)buffer, (int)strlen(buffer));
+  _cupsMD5Finish(&md5, sum);
+  
+  cgiSetCookie(CUPS_SID, httpMD5String(sum, sid), "/", server_name, 0, 0);
+
+  return (cupsGetOption(CUPS_SID, num_cookies, cookies));
+}
+
+
+/*
  * 'cgi_sort_variables()' - Sort all form variables for faster lookup.
  */
 
Index: scheduler/client.c
===================================================================
--- scheduler/client.c	(revision 2066)
+++ scheduler/client.c	(revision 2067)
@@ -381,7 +381,9 @@
 #ifdef AF_INET6
     if (temp.addr.sa_family == AF_INET6)
     {
-      if (HostNameLookups)
+      if (httpAddrLocalhost(&temp))
+        strlcpy(con->servername, "localhost", sizeof(con->servername));
+      else if (HostNameLookups)
         httpAddrLookup(&temp, con->servername, sizeof(con->servername));
       else
         httpAddrString(&temp, con->servername, sizeof(con->servername));
@@ -392,7 +394,9 @@
 #endif /* AF_INET6 */
     if (temp.addr.sa_family == AF_INET)
     {
-      if (HostNameLookups)
+      if (httpAddrLocalhost(&temp))
+        strlcpy(con->servername, "localhost", sizeof(con->servername));
+      else if (HostNameLookups)
         httpAddrLookup(&temp, con->servername, sizeof(con->servername));
       else
         httpAddrString(&temp, con->servername, sizeof(con->servername));
