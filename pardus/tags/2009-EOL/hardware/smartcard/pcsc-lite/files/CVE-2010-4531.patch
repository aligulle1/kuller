Index: pcsc-lite-1.5.5/src/atrhandler.c
===================================================================
--- pcsc-lite-1.5.5.orig/src/atrhandler.c
+++ pcsc-lite-1.5.5/src/atrhandler.c
@@ -230,7 +230,7 @@ short ATRDecodeAtr(PSMARTCARD_EXTENSION
 	psExtension->ATR.HistoryLength = K;
 	memcpy(psExtension->ATR.HistoryValue, &pucAtr[p], K);
 
-	p = p + K;
+	p += K;
 
 	/*
 	 * Check to see if TCK character is included It will be included if
@@ -239,6 +239,9 @@ short ATRDecodeAtr(PSMARTCARD_EXTENSION
 	if (psExtension->CardCapabilities.AvailableProtocols & SCARD_PROTOCOL_T1)
 		TCK = pucAtr[p++];
 
+    if (p > MAX_ATR_SIZE)
+        return 0;       /** @retval 0 Maximum attribute size */
+
 	memcpy(psExtension->ATR.Value, pucAtr, p);
 	psExtension->ATR.Length = p;	/* modified from p-1 */
 
