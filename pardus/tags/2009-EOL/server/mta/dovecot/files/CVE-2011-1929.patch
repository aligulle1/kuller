--- src/lib-mail/message-header-parser.c.orig	2011-05-30 01:19:47.749489943 +0300
+++ src/lib-mail/message-header-parser.c	2011-05-30 01:21:40.085214193 +0300
@@ -267,9 +267,12 @@
 		line->value_len = 0;
 
 		str_truncate(ctx->name, 0);
-		str_append_n(ctx->name, msg, size);
-		line->name = str_c(ctx->name);
-		line->name_len = str_len(ctx->name);
+		/* use buffer_append() so the name won't be truncated if there
+            are NULs. */
+        buffer_append(ctx->name, msg, colon_pos);
+
+        line->name = str_c(ctx->name);
+        line->name_len = str_len(ctx->name);
 
 		line->middle = NULL;
 		line->middle_len = 0;
