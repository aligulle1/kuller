
--- nifticlib-1.1.0.orig/CMakeLists.txt
+++ nifticlib-1.1.0/CMakeLists.txt
@@ -1,6 +1,13 @@
 #File Generated by Hans J. Johnson
 #Please contact hans-johnson@uiowa.edu for making enhancments/corrections
 PROJECT(NIFTI)
+
+# address warnings by cmake 2.6
+cmake_minimum_required(VERSION 2.4)
+if(COMMAND cmake_policy)
+  cmake_policy(SET CMP0003 NEW)
+endif(COMMAND cmake_policy)
+
 # Configure Dart testing support.
 INCLUDE(${CMAKE_ROOT}/Modules/Dart.cmake)
 
--- nifticlib-1.1.0.orig/Testing/CMakeLists.txt
+++ nifticlib-1.1.0/Testing/CMakeLists.txt
@@ -3,5 +3,5 @@
 PROJECT(TESTING)
 
 SUBDIRS(niftilib)
-SUBDIRS(nifti_regress_test)
+#SUBDIRS(nifti_regress_test)
 
--- nifticlib-1.1.0.orig/docs/Doxy_nifti.txt
+++ nifticlib-1.1.0/docs/Doxy_nifti.txt
@@ -36,7 +36,7 @@
 # directories like "/usr/src/myproject". Separate the files or directories 
 # with spaces. 
 
-INPUT                  = ../fsliolib ../niftilib ../znzlib
+INPUT                  = ../niftilib ../znzlib
 
 # If the value of the INPUT tag contains directories, you can use the 
 # FILE_PATTERNS tag to specify one or more wildcard pattern (like *.cpp 
--- nifticlib-1.1.0.orig/nifticdf/CMakeLists.txt
+++ nifticlib-1.1.0/nifticdf/CMakeLists.txt
@@ -6,8 +6,11 @@
 
 SET(NIFTI_CDFLIB_NAME ${PACKAGE_PREFIX}nifticdf)
 
-ADD_LIBRARY(${NIFTI_CDFLIB_NAME} ${NIFTICDFLIB_SRC} )
+# Debian: enable 'unused' function as the AFNI package needs them
+ADD_DEFINITIONS( -D__COMPILE_UNUSED_FUNCTIONS__ )
 
+ADD_LIBRARY(${NIFTI_CDFLIB_NAME} ${NIFTICDFLIB_SRC} )
+TARGET_LINK_LIBRARIES(${NIFTI_CDFLIB_NAME} m )
 IF (BUILD_SHARED_LIBS)
   SET_TARGET_PROPERTIES(${NIFTI_CDFLIB_NAME} PROPERTIES ${NIFTI_LIBRARY_PROPERTIES})
 ENDIF (BUILD_SHARED_LIBS)
--- nifticlib-1.1.0.orig/niftilib/nifti1_io.c
+++ nifticlib-1.1.0/niftilib/nifti1_io.c
@@ -22,6 +22,7 @@
            - revised by Mark Jenkinson, FMRIB
            - revised by Rick Reynolds, SSCC, NIMH
            - revised by Kate Fissell, University of Pittsburgh
+           - fixes   by Yaroslav O. Halchenko, Rutgers-Newark
 
         The library history can be viewed via "nifti_tool -nifti_hist".
     <br>The library version can be viewed via "nifti_tool -nifti_ver".
--- nifticlib-1.1.0.orig/niftilib/nifti1_io.h
+++ nifticlib-1.1.0/niftilib/nifti1_io.h
@@ -450,7 +450,10 @@
 
 #define NIFTI_ECODE_FREESURFER      14  /* http://surfer.nmr.mgh.harvard.edu */
 
-#define NIFTI_MAX_ECODE             14  /******* maximum extension code *******/
+#define NIFTI_ECODE_PYPICKLE        16  /* Embedded Python objects
+                                           http://niftilib.sourceforge.net/pynifti */
+
+#define NIFTI_MAX_ECODE             16  /******* maximum extension code *******/
 
 /* nifti_type file codes */
 #define NIFTI_FTYPE_ANALYZE   0
--- nifticlib-1.1.0.orig/utils/CMakeLists.txt
+++ nifticlib-1.1.0/utils/CMakeLists.txt
@@ -7,7 +7,7 @@
 ADD_EXECUTABLE(${PACKAGE_PREFIX}nifti_stats nifti_stats.c)
 ADD_EXECUTABLE(${PACKAGE_PREFIX}nifti_tool nifti_tool.c)
 ADD_EXECUTABLE(${PACKAGE_PREFIX}nifti1_test nifti1_test.c)
-TARGET_LINK_LIBRARIES( nifti_stats ${PACKAGE_PREFIX}niftiio ${PACKAGE_PREFIX}nifticdf)
+TARGET_LINK_LIBRARIES( nifti_stats ${PACKAGE_PREFIX}nifticdf)
 TARGET_LINK_LIBRARIES( nifti_tool  ${PACKAGE_PREFIX}niftiio)
 TARGET_LINK_LIBRARIES( nifti1_test ${PACKAGE_PREFIX}niftiio)
 

