
 http://bugzilla.maptools.org/show_bug.cgi?id=1996

diff -Naurp tiff-3.9.1/libtiff/tif_ojpeg.c tiff-3.9.1.oden/libtiff/tif_ojpeg.c
--- tiff-3.9.1/libtiff/tif_ojpeg.c	2010-08-05 12:02:05.000000000 -0400
+++ tiff-3.9.1.oden/libtiff/tif_ojpeg.c	2010-08-05 12:02:29.000000000 -0400
@@ -1913,6 +1913,10 @@ OJPEGReadBufferFill(OJPEGState* sp)
 							sp->in_buffer_file_pos=0;
 						else
 						{
+							if (sp->tif->tif_dir.td_stripbytecount == 0) {
+								TIFFErrorExt(sp->tif->tif_clientdata,sp->tif->tif_name,"Strip byte counts are missing");
+								return(0);
+							}
 							sp->in_buffer_file_togo=sp->tif->tif_dir.td_stripbytecount[sp->in_buffer_next_strile];  
 							if (sp->in_buffer_file_togo==0)
 								sp->in_buffer_file_pos=0;
diff -Naurp tiff-3.9.1/tools/tiffsplit.c tiff-3.9.1.oden/tools/tiffsplit.c
--- tiff-3.9.1/tools/tiffsplit.c	2009-01-21 11:28:57.000000000 -0500
+++ tiff-3.9.1.oden/tools/tiffsplit.c	2010-08-05 12:02:29.000000000 -0400
@@ -237,7 +237,10 @@ cpStrips(TIFF* in, TIFF* out)
 		tstrip_t s, ns = TIFFNumberOfStrips(in);
 		uint32 *bytecounts;
 
-		TIFFGetField(in, TIFFTAG_STRIPBYTECOUNTS, &bytecounts);
+		if (!TIFFGetField(in, TIFFTAG_STRIPBYTECOUNTS, &bytecounts)) {
+			fprintf(stderr, "tiffsplit: strip byte counts are missing\n");
+			return (0);
+		}
 		for (s = 0; s < ns; s++) {
 			if (bytecounts[s] > (uint32)bufsize) {
 				buf = (unsigned char *)_TIFFrealloc(buf, bytecounts[s]);
@@ -267,7 +270,10 @@ cpTiles(TIFF* in, TIFF* out)
 		ttile_t t, nt = TIFFNumberOfTiles(in);
 		uint32 *bytecounts;
 
-		TIFFGetField(in, TIFFTAG_TILEBYTECOUNTS, &bytecounts);
+		if (!TIFFGetField(in, TIFFTAG_TILEBYTECOUNTS, &bytecounts)) {
+			fprintf(stderr, "tiffsplit: tile byte counts are missing\n");
+			return (0);
+		}
 		for (t = 0; t < nt; t++) {
 			if (bytecounts[t] > (uint32) bufsize) {
 				buf = (unsigned char *)_TIFFrealloc(buf, bytecounts[t]);
