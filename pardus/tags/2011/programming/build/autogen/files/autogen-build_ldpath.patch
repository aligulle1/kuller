diff -urN doc.orig/auto-opts.tpl doc/auto-opts.tpl
--- doc.orig/auto-opts.tpl	2010-07-10 20:08:57.000000000 +0200
+++ doc/auto-opts.tpl	2010-09-11 05:22:09.000000000 +0200
@@ -106,7 +106,7 @@
 	_EOF_
 (
   ${AGexe} -L${top_srcdir}/autoopts checkopt.def
-  opts=\"-o check -DTEST_CHECK_OPTS ${CFLAGS} ${INCLUDES}\"
+  opts=\"-o check -DTEST_CHECK_OPTS ${CFLAGS} ${LDFLAGS} ${INCLUDES}\"
   ${CC} -include ${top_builddir}/config.h ${opts} checkopt.c ${LIBS}
 ) > checkopt.err 2>&1
 
diff -urN doc.orig/mk-agen-texi-in doc/mk-agen-texi-in
--- doc.orig/mk-agen-texi-in	2010-09-08 02:35:48.000000000 +0200
+++ doc/mk-agen-texi-in	2010-09-11 05:24:42.000000000 +0200
@@ -90,8 +90,9 @@
   srcdir=`cd @srcdir@ ; pwd`
   PATH=${top_builddir}/columns:${PATH}
   timer=`expr @AG_TIMEOUT@ '*' 5`
-  d=`find ${top_builddir}/autoopts -type f -name libopts.a`
-  LIBS="$d ${LIBS}"
+  d=`find ${top_builddir}/autoopts -type f -name libopts.a -o -name libopts.so | head -n 1`
+  LIBS="-L`dirname \"$d\"` -lopts ${LIBS}"
+  LD_LIBRARY_PATH="`dirname \"$d\"`:$LD_LIBRARY_PATH"
 
   eval `egrep '^AG_[A-Z_]*' ${top_srcdir}/VERSION`
 
@@ -100,7 +101,7 @@
   GDexe=@GDexe@
   CLexe=@CLexe@
 
-  LIBS=${LIBS}\ `find ${top_builddir}/autoopts -name libopts.a -print`
+  LIBS="${LIBS} `find ${top_builddir}/autoopts -name libopts.a -print`"
   OPTIONS_DEF=${AGsrc}/opts.def
   DIRECTIVESRC=${AGsrc}/defDirect.c
   GETDEF_SRC=`
@@ -211,7 +212,7 @@
 sanity_check
 run_getdefs
 
-env >&2
+${VERBOSE} && env | sort >&2
 exec 3> ${tmp_dir}/ag.ini
 cat >&3 <<- _EOF_
 	timeout     ${timer}
